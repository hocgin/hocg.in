------
title: åˆ¶ä½œ.ipkå®‰è£…æ–‡ä»¶
date: 2017-11-19 12:30:21
update: 2018-1-4 16:26:11
tags:
  - OpenWrt
  - Tips
  - Shell
categories:
  - OpenWrt
------
`.ipk` æœ¬è´¨æ˜¯`tar.gz`æ ¼å¼çš„å‹ç¼©åŒ…, æŒ‰ç…§æŸç§è§„èŒƒæ ¼å¼(`ç±»ä¼¼.debåŒ…`)è¿›è¡Œ ...
<!--more-->
## å‰è¨€
1. `.ipk` æœ¬è´¨æ˜¯`tar.gz`æ ¼å¼çš„å‹ç¼©åŒ…, æŒ‰ç…§æŸç§è§„èŒƒæ ¼å¼(`ç±»ä¼¼.debåŒ…`)è¿›è¡Œå‹ç¼©è€Œæˆçš„ã€‚
2. å½“æˆ‘ä»¬å¯¹å®ƒçš„å†…å®¹è¿›è¡Œæ“ä½œæ—¶å€™æ‰€ä½¿ç”¨çš„ç”¨æˆ·å³æ˜¯å®ƒå®‰è£…åæ‰€æ‹¥æœ‰çš„ç”¨æˆ·å’Œæƒé™(`sudo chown root:root -R .`)ã€‚
3. å·²ç»å­˜åœ¨çš„æ–‡ä»¶å¹¶ä¸èƒ½è¿›è¡Œæ›¿æ¢, åˆ‡è®°ã€‚

## æ–‡ä»¶ä»‹ç»
```bash
.
â”œâ”€â”€ control.tar.gz # å®‰è£…/å¸è½½ è„šæœ¬
â”œâ”€â”€ data.tar.gz # äºŒè¿›åˆ¶/é…ç½®æ–‡ä»¶..
â””â”€â”€ debian-binary # å›ºæœ‰æ–‡ä»¶
```

## control.tar.gz å†…å®¹
```bash
.
â”œâ”€â”€ control # æ–‡ä»¶ä»‹ç»[åŒ…æ‹¬: ä¾èµ–/ç‰ˆæœ¬/æ¶æ„/ä½œè€…..]
â”œâ”€â”€ postinst # å®‰è£…è„šæœ¬
â””â”€â”€ postrm # å¸è½½è„šæœ¬
```
### `control` æ­¤å¤„ä¸¾ä¸ªæ —å­
```bash
Package: IPKName # .ipk NAME
Version: 1
Section: net
Priority: optional
Architecture: ar71xx # ç³»ç»Ÿæ¶æ„
Maintainer: hocgin <hocgin@gmail.com>
Description: my first ipk
```

### postinst å®‰è£…è„šæœ¬
> å› ä¸ºå‰è¨€çš„`3`åŸå› , å½“æˆ‘ä»¬éœ€è¦å¯¹å·²å­˜åœ¨æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶, åªèƒ½ä½¿ç”¨å†™å…¥çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚

ä¾‹å¦‚:
```bash
#!/bin/sh
echo "installed done" > /tmp/ipk.log
```
### postinst å¸è½½è„šæœ¬
> è‡ªå·±çº¦çš„XğŸ¤£ã€‚ã€‚

ä¾‹å¦‚:
```bash
#!/bin/sh
rm -rf /tmp/ipk.log
```
### æ‰“åŒ…~
```bash
sudo tar -czf control.tar.gz *
```

## data.tar.gz
> æ­¤å¤„å®Œå…¨æ˜¯æ ¹æ®ä½ è¦å¢åŠ çš„è„šæœ¬æŒ‰æ ¹ç›®å½•è¿›è¡Œå­˜æ”¾çš„ã€‚

ä¾‹å¦‚:
```bash
.
â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ ss-redir
â”‚Â Â  â””â”€â”€ ss-tunnel
â”œâ”€â”€ data.tar.gz
â”œâ”€â”€ etc
â”‚Â Â  â”œâ”€â”€ dnsmasq.d
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ address.conf
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dns.conf
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ipset.conf
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ option.conf
â”‚Â Â  â”‚Â Â  â””â”€â”€ server.conf
â”‚Â Â  â”œâ”€â”€ pdnsd.conf
â”‚Â Â  â””â”€â”€ shadowsock.json
â”œâ”€â”€ root
â”‚Â Â  â”œâ”€â”€ addDnsmasq.sh
â”‚Â Â  â””â”€â”€ changeService.sh
â””â”€â”€ usr
    â””â”€â”€ sbin
        â””â”€â”€ pdnsd
```
### æ‰“åŒ…~
```bash
sudo tar -czf data.tar.gz *
```
## æœ€å
> å°†ä¸‰ä¸ªæ–‡ä»¶æ”¾åœ¨ä¸€èµ·è¿›è¡Œæ‰“åŒ…

```bash
sudo tar -czf mIPK.ipk *
```

