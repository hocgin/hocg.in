<!--
   _                     _
  | |__   ___   ___ __ _(_)_ __
  | '_ \ / _ \ / __/ _` | | '_ \
  | | | | (_) | (_| (_| | | | | |
  |_| |_|\___/ \___\__, |_|_| |_|
                   |___/
-->
<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>Elasticsearch éšæ‰‹è®° | hocgin (à¹‘`ç¬Â´à¹‘)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Elasticsearch éšæ‰‹è®° ğŸ˜‹">
<meta name="keywords" content="Elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch éšæ‰‹è®°">
<meta property="og:url" content="https://hocg.in/2019/03/23/Elasticsearch éšæ‰‹è®°/index.html">
<meta property="og:site_name" content="hocgin (à¹‘`ç¬Â´à¹‘)">
<meta property="og:description" content="Elasticsearch éšæ‰‹è®° ğŸ˜‹">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-03-23T07:33:38.002Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Elasticsearch éšæ‰‹è®°">
<meta name="twitter:description" content="Elasticsearch éšæ‰‹è®° ğŸ˜‹">
    

    
        <link rel="alternate" href="/" title="hocgin (à¹‘`ç¬Â´à¹‘)" type="application/atom+xml" />
    

    
        <link rel="icon" href="/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/firacode/fira_code.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75635029-1', 'auto');
ga('send', 'pageview');

</script>
    
    
        <meta name="google-site-verification" content="BIu5FVv0ybO_ceKwrQ-A7znPy4ObYjrCIbLTvcKxqAM" />
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <!--<i class="logo"></i>-->
                <span class="site-title">hocgin (à¹‘`ç¬Â´à¹‘)</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">é¦–é¡µ</a>
                
                    <a class="main-nav-link" href="/archives">å½’æ¡£</a>
                
                    <a class="main-nav-link" href="/categories">åˆ†ç±»</a>
                
                    <a class="main-nav-link" href="/tags">æ ‡ç­¾</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="æœç´¢" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æœªå‘½å)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">é¦–é¡µ</a></td>
                
                    <td><a class="main-nav-link" href="/archives">å½’æ¡£</a></td>
                
                    <td><a class="main-nav-link" href="/categories">åˆ†ç±»</a></td>
                
                    <td><a class="main-nav-link" href="/tags">æ ‡ç­¾</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="æœç´¢" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            <section id="main"><article id="post-Elasticsearch éšæ‰‹è®°"
         class="article article-type-post "
         itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        <header class="article-header">
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2019/03/23/Elasticsearch éšæ‰‹è®°/">
            <time datetime="2019-03-23T05:53:00.000Z" itemprop="datePublished">2019-03-23</time>
        </a>
    </div>


                <div>â€¢</div>
                
    <div class="article-category">
        <a class="article-category-link" href="/categories/æœåŠ¡ç«¯/">æœåŠ¡ç«¯</a>
    </div>

            </div>
            
    
        <h1 class="article-title" itemprop="name">
            Elasticsearch éšæ‰‹è®°
        </h1>
    

        </header>
        
        
        <div class="article-entry" itemprop="articleBody">
            
            
            <p>Elasticsearch éšæ‰‹è®° ğŸ˜‹<br><a id="more"></a></p>
<h2 id="ElasticSearch-å¯¹æ¯”-MySQL"><a href="#ElasticSearch-å¯¹æ¯”-MySQL" class="headerlink" title="ElasticSearch å¯¹æ¯” MySQL"></a>ElasticSearch å¯¹æ¯” MySQL</h2><ul>
<li>Index -&gt; Database</li>
<li>Type -&gt; Table</li>
<li>Document -&gt; Row</li>
</ul>
<hr>
<h2 id="ç´¢å¼•æ¨¡ç‰ˆæ•°æ®ç±»å‹"><a href="#ç´¢å¼•æ¨¡ç‰ˆæ•°æ®ç±»å‹" class="headerlink" title="ç´¢å¼•æ¨¡ç‰ˆæ•°æ®ç±»å‹"></a>ç´¢å¼•æ¨¡ç‰ˆæ•°æ®ç±»å‹</h2><ul>
<li>å­—ç¬¦ä¸²ç±»å‹ <del>string</del>,text,keyword </li>
<li>æ•´æ•°ç±»å‹ integer,long,short,byte </li>
<li>æµ®ç‚¹ç±»å‹ double,float,half_float,scaled_float </li>
<li>é€»è¾‘ç±»å‹ boolean </li>
<li>æ—¥æœŸç±»å‹ date </li>
<li>èŒƒå›´ç±»å‹ range </li>
<li>äºŒè¿›åˆ¶ç±»å‹ binary </li>
<li>å¤åˆç±»å‹ æ•°ç»„ç±»å‹ array </li>
<li>å¯¹è±¡ç±»å‹ object </li>
<li>åµŒå¥—ç±»å‹ nested </li>
<li>åœ°ç†ç±»å‹ åœ°ç†åæ ‡ç±»å‹ geo_point </li>
<li>åœ°ç†åœ°å›¾ geo_shape </li>
<li>ç‰¹æ®Šç±»å‹ IPç±»å‹ ip </li>
<li>èŒƒå›´ç±»å‹ completion </li>
<li>ä»¤ç‰Œè®¡æ•°ç±»å‹ token_count </li>
<li>é™„ä»¶ç±»å‹ attachment </li>
<li>æŠ½å–ç±»å‹ percolator </li>
</ul>
<hr>
<h2 id="API-æ¥å£"><a href="#API-æ¥å£" class="headerlink" title="API æ¥å£"></a>API æ¥å£</h2><blockquote>
<p>pretty æ ¼å¼åŒ–<br>explain=true åˆ†æ</p>
<ul>
<li>é€šé…ç¬¦</li>
</ul>
</blockquote>
<h3 id="ç›‘æ§æ“ä½œ"><a href="#ç›‘æ§æ“ä½œ" class="headerlink" title="ç›‘æ§æ“ä½œ"></a>ç›‘æ§æ“ä½œ</h3><ul>
<li>ç›‘æ§<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢æ‰€æœ‰ç›‘æ§æŒ‡ä»¤</span><br><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/_cat</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="èŠ‚ç‚¹æ“ä½œ"><a href="#èŠ‚ç‚¹æ“ä½œ" class="headerlink" title="èŠ‚ç‚¹æ“ä½œ"></a>èŠ‚ç‚¹æ“ä½œ</h3><ul>
<li><p>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹è®¾ç½®</span><br><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/_cluster/settings?pretty</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®æ—¶æ›´æ”¹é…ç½®</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># æ°¸ä¹…ç”Ÿæ•ˆ</span><br><span class="line">curl --user elastic:changeme -XPUT http://127.0.0.1:9200/_cluster/settings -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "persistent": &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br><span class="line"># æš‚æ—¶ç”Ÿæ•ˆ</span><br><span class="line">curl --user elastic:changeme -XPUT http://127.0.0.1:9200/_cluster/settings -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "transient": &#123;&#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><ul>
<li><p>åˆ›å»ºç´¢å¼•æ¨¡ç‰ˆ</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XPUT http://127.0.0.1:9200/db_test2 -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "settings":&#123;</span><br><span class="line">        # èŠ‚ç‚¹æ•°é‡</span><br><span class="line">        "number_of_replicas": 0,</span><br><span class="line">        # åˆ†ç‰‡æ•°é‡</span><br><span class="line">        # "number_of_shards": 5,</span><br><span class="line">        # ç´¢å¼•å­˜å‚¨ç±»å‹</span><br><span class="line">        # "index.store.type": "niofs",</span><br><span class="line">        # é»˜è®¤æ£€ç´¢å­—æ®µ</span><br><span class="line">        # "index.query.default_field": "title"</span><br><span class="line">        # "index.unassigned.node_left.delayed_timeout": "5m"</span><br><span class="line">    &#125;,</span><br><span class="line">    "mappings": &#123;</span><br><span class="line">        "example": &#123;</span><br><span class="line">            # åŠ¨æ€å˜æ›´</span><br><span class="line">            "dynamic": false,</span><br><span class="line">            # 5.x ä»¥ä¸ŠåºŸé™¤</span><br><span class="line">            "_all": &#123;</span><br><span class="line">                "enabled": false</span><br><span class="line">            &#125;,</span><br><span class="line">            "properties": &#123;</span><br><span class="line">                "example_id": &#123;</span><br><span class="line">                    "type": "long"</span><br><span class="line">                &#125;,</span><br><span class="line">                "name": &#123;</span><br><span class="line">                    "type": "text",</span><br><span class="line">                    # æŒ‡å®šåˆ†è¯å™¨</span><br><span class="line">                    "analyzer": "ik_max_word",</span><br><span class="line">                    "search_analyzer": "ik_max_word"</span><br><span class="line">                &#125;,</span><br><span class="line">                "text": &#123;</span><br><span class="line">                    "type": "keyword"</span><br><span class="line">                &#125;,</span><br><span class="line">                "title": &#123;</span><br><span class="line">                    "type": "text",</span><br><span class="line">                    "index": true</span><br><span class="line">                &#125;,</span><br><span class="line">                "createdAt": &#123;</span><br><span class="line">                    "type": "date",</span><br><span class="line">                    "format": "strict_date_optional_time||epoch_millis"</span><br><span class="line">                &#125;,</span><br><span class="line">                "age": &#123;</span><br><span class="line">                    "type": "integer"</span><br><span class="line">                &#125;,</span><br><span class="line">                "location": &#123;</span><br><span class="line">                    # es ä¸­å­˜å‚¨ç»“æ„ä¸º: &#123;lon: 0.000, lat: 0.000&#125;</span><br><span class="line">                    "type": "geo_point"</span><br><span class="line">                &#125;,</span><br><span class="line">                "suggest": &#123;</span><br><span class="line">                    "type": "completion"</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤ç´¢å¼•æ¨¡ç‰ˆ</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XDELETE http://127.0.0.1:9200/db_test</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥è¯¢ç´¢å¼•æ¨¡ç‰ˆ</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/db_test\?pretty</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ’å…¥æ•°æ®</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/db_test/example -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "example_id": 666</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥è¯¢æ•°æ®</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢æ‰€æœ‰</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/db_test/example/_search?pretty</span><br><span class="line"># æŒ‰æ¡ä»¶æŸ¥è¯¢</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/db_test/example/_search?pretty&amp;explain=true -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "query": &#123;</span><br><span class="line">        "match": &#123;</span><br><span class="line">            "example_id": 666</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢æŒ‡å®š</span><br><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/db_test/example/PiAmoGkBJAdUJ3wD4CMC?pretty=true</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="åˆ†ææ“ä½œ"><a href="#åˆ†ææ“ä½œ" class="headerlink" title="åˆ†ææ“ä½œ"></a>åˆ†ææ“ä½œ</h3><ul>
<li>åˆ†è¯å™¨æ¥å£<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨é»˜è®¤åˆ†è¯å™¨</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/_analyze?pretty -H 'Content-Type:application/json' -d'&#123; </span><br><span class="line">    "text": "Hello World" </span><br><span class="line">&#125;'</span><br><span class="line"># ä½¿ç”¨æŒ‡å®šåˆ†è¯å™¨</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/_analyze?pretty -H 'Content-Type:application/json' -d'&#123;</span><br><span class="line">    "analyzer": "ik_max_word",</span><br><span class="line">    "text": "Hello World" </span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="Java-è°ƒç”¨"><a href="#Java-è°ƒç”¨" class="headerlink" title="Java è°ƒç”¨"></a>Java è°ƒç”¨</h2><ul>
<li><p>åˆ›å»ºç´¢å¼•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">createOrUpdateIndex</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (house == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ExampleIndexTemplate template = <span class="comment">// .. é€šè¿‡æ„å»ºå¾—å‡º</span></span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                .setQuery(QueryBuilders.termQuery(<span class="string">"example_id"</span>, id));</span><br><span class="line"></span><br><span class="line">        logger.debug(requestBuilder.toString());</span><br><span class="line">        SearchResponse searchResponse = requestBuilder.get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> success;</span><br><span class="line">        <span class="keyword">long</span> totalHit = searchResponse.getHits().getTotalHits();</span><br><span class="line">        <span class="keyword">if</span> (totalHit == <span class="number">0</span>) &#123;</span><br><span class="line">            success = create(template);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (totalHit == <span class="number">1</span>) &#123;</span><br><span class="line">            String esId = searchResponse.getHits().getAt(<span class="number">0</span>).getId();</span><br><span class="line">            success = update(id, template);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            success = deleteAndCreate(totalHit, template);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">create</span><span class="params">(ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            IndexResponse response = <span class="keyword">this</span>.esClient.prepareIndex(INDEX_NAME, INDEX_TYPE)</span><br><span class="line">                    .setSource(objectMapper.writeValueAsBytes(indexTemplate), XContentType.JSON).get();</span><br><span class="line">            <span class="keyword">if</span> (response.status() == RestStatus.CREATED) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Long id, ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UpdateResponse response = <span class="keyword">this</span>.esClient.prepareUpdate(INDEX_NAME, INDEX_TYPE, id).setDoc(objectMapper.writeValueAsBytes(indexTemplate), XContentType.JSON).get();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (response.status() == RestStatus.OK) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">deleteAndCreate</span><span class="params">(<span class="keyword">long</span> totalHit, ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">        DeleteByQueryRequestBuilder builder = DeleteByQueryAction.INSTANCE</span><br><span class="line">                .newRequestBuilder(esClient)</span><br><span class="line">                .filter(QueryBuilders.termQuery(<span class="string">"example_id"</span>, indexTemplate.getId()))</span><br><span class="line">                .source(INDEX_NAME);</span><br><span class="line"></span><br><span class="line">        BulkByScrollResponse response = builder.get();</span><br><span class="line">        <span class="keyword">long</span> deleted = response.getDeleted();</span><br><span class="line">        <span class="keyword">if</span> (deleted != totalHit) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> create(indexTemplate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç§»é™¤ç´¢å¼•æ¨¡ç‰ˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    DeleteByQueryRequestBuilder builder = DeleteByQueryAction.INSTANCE</span><br><span class="line">            .newRequestBuilder(esClient)</span><br><span class="line">            .filter(QueryBuilders.termQuery(<span class="string">"example_id"</span>, id))</span><br><span class="line">            .source(INDEX_NAME);</span><br><span class="line">    BulkByScrollResponse response = builder.get();</span><br><span class="line">    <span class="keyword">long</span> deleted = response.getDeleted();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç®€å•æœç´¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡æœç´¢æŸ¥è¯¢å‡ºidï¼Œ ç„¶åäº mysql ä¹‹ç±»æ•°æ®åº“è¿›è¡Œèšåˆ</span></span><br><span class="line"><span class="function">List&lt;Serializable&gt; <span class="title">search</span><span class="params">(SearchBody body)</span></span>&#123;</span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ»¡è¶³filterå­å¥çš„æ¡ä»¶ã€‚ä½†æ˜¯ä¸ä¼šåƒMustä¸€æ ·ï¼Œå‚ä¸è®¡ç®—åˆ†å€¼</span></span><br><span class="line">        boolQuery.filter(</span><br><span class="line">            <span class="comment">// QueryBuilders.termQuery</span></span><br><span class="line">            <span class="comment">// QueryBuilders.rangeQuery</span></span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment">//        æé«˜æƒé‡, å¦‚æœéœ€è¦çš„è¯</span></span><br><span class="line"><span class="comment">//        boolQuery.must(</span></span><br><span class="line"><span class="comment">//                QueryBuilders.matchQuery("title", body.getKeywords())</span></span><br><span class="line"><span class="comment">//                        .boost(2.0f)</span></span><br><span class="line"><span class="comment">//        );</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// [å¿…é¡»æ»¡è¶³çš„æ„æ€] æ»¡è¶³mustå­å¥çš„æ¡ä»¶ï¼Œå¹¶ä¸”å‚ä¸è®¡ç®—åˆ†å€¼</span></span><br><span class="line">        boolQuery.must(</span><br><span class="line">            <span class="comment">// QueryBuilders.multiMatchQuery  å…³é”®è¯åŒ¹é…å¤šä¸ªå­—æ®µ</span></span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ»¡è¶³shouldå­å¥çš„æ¡ä»¶ã€‚åœ¨ä¸€ä¸ªBoolæŸ¥è¯¢ä¸­ï¼Œå¦‚æœæ²¡æœ‰mustæˆ–è€…filterï¼Œæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªshouldå­å¥ï¼Œé‚£ä¹ˆåªè¦æ»¡è¶³ä¸€ä¸ªå°±å¯ä»¥è¿”å›</span></span><br><span class="line">        boolQuery.should(</span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸æ»¡è¶³must_notå®šä¹‰çš„æ¡ä»¶</span></span><br><span class="line">        boolQuery.should(</span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                <span class="comment">// æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">                .setQuery(boolQuery)</span><br><span class="line">                <span class="comment">// æ’åº</span></span><br><span class="line">                .addSort(</span><br><span class="line">                        <span class="string">"createdAt"</span>, <span class="string">"DESC"</span></span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// å¼€å§‹ä½ç½®</span></span><br><span class="line">                .setFrom(<span class="number">0</span>)</span><br><span class="line">                .setSize(<span class="number">100</span>)</span><br><span class="line">                <span class="comment">// è®¾ç½®è¯¥å­—æ®µå¯ä»¥æœ‰æ•ˆå‡å°‘è¿”å›æ•°æ®é‡</span></span><br><span class="line">                .setFetchSource(<span class="string">"id"</span>, <span class="keyword">null</span>);</span><br><span class="line">        SearchResponse response = requestBuilder.get();</span><br><span class="line"></span><br><span class="line">        List&lt;Long&gt; ids = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSource());</span><br><span class="line">            ids.add(Longs.tryParse(String.valueOf(hit.getSource().get(<span class="string">"example_id"</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‡ªåŠ¨è¡¥å…¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…</span></span><br><span class="line"><span class="function">Collection&lt;String&gt; <span class="title">suggest</span><span class="params">(String prefix)</span></span>&#123;</span><br><span class="line">    CompletionSuggestionBuilder suggestion = SuggestBuilders.completionSuggestion(<span class="string">"suggest"</span>).prefix(prefix).size(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        SuggestBuilder suggestBuilder = <span class="keyword">new</span> SuggestBuilder();</span><br><span class="line">        suggestBuilder.addSuggestion(<span class="string">"autocomplete"</span>, suggestion);</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                .suggest(suggestBuilder);</span><br><span class="line"></span><br><span class="line">        SearchResponse response = requestBuilder.get();</span><br><span class="line">        Suggest suggest = response.getSuggest();</span><br><span class="line">        <span class="keyword">if</span> (suggest == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ServiceResult.of(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        Suggest.Suggestion result = suggest.getSuggestion(<span class="string">"autocomplete"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> maxSuggest = <span class="number">0</span>;</span><br><span class="line">        Set&lt;String&gt; suggestSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object term : result.getEntries()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (term <span class="keyword">instanceof</span> CompletionSuggestion.Entry) &#123;</span><br><span class="line">                CompletionSuggestion.Entry item = (CompletionSuggestion.Entry) term;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (item.getOptions().isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (CompletionSuggestion.Entry.Option option : item.getOptions()) &#123;</span><br><span class="line">                    String tip = option.getText().string();</span><br><span class="line">                    <span class="keyword">if</span> (suggestSet.contains(tip)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    suggestSet.add(tip);</span><br><span class="line">                    maxSuggest++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (maxSuggest &gt; <span class="number">5</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> suggestSet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æƒé‡</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">updateSuggest</span><span class="params">(ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">    AnalyzeRequestBuilder requestBuilder = <span class="keyword">new</span> AnalyzeRequestBuilder(</span><br><span class="line">            <span class="keyword">this</span>.esClient, AnalyzeAction.INSTANCE, INDEX_NAME, </span><br><span class="line">            <span class="comment">// ä¼šè¢«æœç´¢çš„å­—æ®µçš„å€¼..</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨çš„åˆ†è¯å™¨</span></span><br><span class="line">    requestBuilder.setAnalyzer(<span class="string">"ik_smart"</span>);</span><br><span class="line"></span><br><span class="line">    AnalyzeResponse response = requestBuilder.get();</span><br><span class="line">    List&lt;AnalyzeResponse.AnalyzeToken&gt; tokens = response.getTokens();</span><br><span class="line">    <span class="keyword">if</span> (tokens == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;HouseSuggest&gt; suggests = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (AnalyzeResponse.AnalyzeToken token : tokens) &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæ•ˆé™åˆ¶</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"&lt;NUM&gt;"</span>.equals(token.getType()) || token.getTerm().length() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExampleSuggest suggest = <span class="comment">// ..</span></span><br><span class="line">        suggests.add(suggest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–å½±å“å› ç´ </span></span><br><span class="line">    ExampleSuggest suggest = <span class="comment">// ..</span></span><br><span class="line">    suggests.add(suggest);</span><br><span class="line"></span><br><span class="line">    indexTemplate.setSuggest(suggests);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>èšåˆç»Ÿè®¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">aggregateNumber</span><span class="params">(String c1, String c2, String c3)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery()</span><br><span class="line">                .filter(QueryBuilders.termQuery(</span><br><span class="line">                    <span class="comment">// èšåˆæ¡ä»¶</span></span><br><span class="line">                ))</span><br><span class="line">                .filter(QueryBuilders.termQuery(</span><br><span class="line">                    <span class="comment">// èšåˆæ¡ä»¶</span></span><br><span class="line">                ))</span><br><span class="line">                .filter(QueryBuilders.termQuery(</span><br><span class="line">                    <span class="string">"field_name"</span>,</span><br><span class="line">                    c1</span><br><span class="line">                ));</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                .setQuery(boolQuery)</span><br><span class="line">                .addAggregation(</span><br><span class="line">                        AggregationBuilders.terms(<span class="string">"agg_number"</span>)</span><br><span class="line">                        .field(<span class="string">"field_name"</span>)</span><br><span class="line">                ).setSize(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        logger.debug(requestBuilder.toString());</span><br><span class="line"></span><br><span class="line">        SearchResponse response = requestBuilder.get();</span><br><span class="line">        <span class="keyword">if</span> (response.status() == RestStatus.OK) &#123;</span><br><span class="line">            Terms terms = response.getAggregations().get(<span class="string">"agg_number"</span>);</span><br><span class="line">            <span class="keyword">if</span> (terms.getBuckets() != <span class="keyword">null</span> &amp;&amp; !terms.getBuckets().isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> terms.getBucketByKey(c1).getDocCount();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½ç½®èŒƒå›´æŸ¥è¯¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Collection&lt;Long&gt; <span class="title">mapQuery</span><span class="params">(SearchBody body)</span> </span>&#123;</span><br><span class="line">    BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line">    boolQuery.filter(QueryBuilders.termQuery(</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    boolQuery.filter(</span><br><span class="line">        QueryBuilders.geoBoundingBoxQuery(<span class="string">"location"</span>)</span><br><span class="line">            .setCorners(</span><br><span class="line">                    <span class="comment">// å·¦ä¸Šè§’</span></span><br><span class="line">                    <span class="keyword">new</span> GeoPoint(body.getLeftLatitude(), body.getLeftLongitude()),</span><br><span class="line">                    <span class="comment">// å³ä¸‹è§’</span></span><br><span class="line">                    <span class="keyword">new</span> GeoPoint(body.getRightLatitude(), body.getRightLongitude())</span><br><span class="line">            ));</span><br><span class="line"></span><br><span class="line">    SearchRequestBuilder builder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">            .setTypes(INDEX_TYPE)</span><br><span class="line">            .setQuery(boolQuery)</span><br><span class="line">            .addSort(</span><br><span class="line">                <span class="comment">// ..</span></span><br><span class="line">            )</span><br><span class="line">            .setFrom(<span class="number">0</span>)</span><br><span class="line">            .setSize(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    SearchResponse response = builder.get();</span><br><span class="line">    <span class="keyword">if</span> (RestStatus.OK != response.status()) &#123;</span><br><span class="line">        <span class="keyword">return</span> ids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">        ids.add(hit.getSource().get(<span class="string">"example_id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="JSONæ ¼å¼æŸ¥è¯¢è¯­æ³•"><a href="#JSONæ ¼å¼æŸ¥è¯¢è¯­æ³•" class="headerlink" title="JSONæ ¼å¼æŸ¥è¯¢è¯­æ³•"></a>JSONæ ¼å¼æŸ¥è¯¢è¯­æ³•</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h3><blockquote>
<ul>
<li>must<code>å‚ä¸è®¡ç®—åˆ†å€¼</code> -&gt; and</li>
<li>filter<code>ä¸å‚ä¸è®¡ç®—åˆ†å€¼</code> -&gt; and</li>
<li>should -&gt; or</li>
<li>must_not -&gt; not<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// å¸ƒå°”æŸ¥è¯¢</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123; </span><br><span class="line">    <span class="attr">"bool"</span>: &#123; </span><br><span class="line">      // The clause (query) must appear in matching documents and will contribute to the score.</span><br><span class="line">      // æ‰€æœ‰"must"æ¡ä»¶å¿…é¡»åŒ¹é…æˆåŠŸ, ä¸”è®¡ç®—åˆ†æ•°</span><br><span class="line">      "must": [</span><br><span class="line">        &#123; "match": &#123; "title":   "Search"        &#125;&#125;, </span><br><span class="line">        &#123; <span class="attr">"match"</span>: &#123; <span class="attr">"content"</span>: <span class="string">"Elasticsearch"</span> &#125;&#125;  </span><br><span class="line">      ],</span><br><span class="line">      // The clause (query) must appear in matching documents. However unlike must the score of the query will be ignored. Filter clauses are executed in filter context, meaning that scoring is ignored and clauses are considered for caching.</span><br><span class="line">      // æ‰€æœ‰"filter"æ¡ä»¶å¿…é¡»åŒ¹é…æˆåŠŸ, ä¸è®¡ç®—åˆ†æ•°(å› æ­¤æŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«)</span><br><span class="line">      "filter": [ </span><br><span class="line">        &#123; "term":  &#123; "status": "published" &#125;&#125;, </span><br><span class="line">        &#123; <span class="attr">"range"</span>: &#123; <span class="attr">"publish_date"</span>: &#123; <span class="attr">"gte"</span>: <span class="string">"2015-01-01"</span> &#125;&#125;&#125; </span><br><span class="line">      ],</span><br><span class="line">      // The clause (query) should appear in the matching document. If the bool query is in a query context and has a must or filter clause then a document will match the bool query even if none of the should queries match. In this case these clauses are only used to influence the score. If the bool query is a filter context or has neither must or filter then at least one of the should queries must match a document for it to match the bool query. This behavior may be explicitly controlled by settings the minimum_should_match parameter.</span><br><span class="line">      // æƒ…å†µä¸€(åµŒå¥—bool): å½“"should"æ¡ä»¶åœ¨"must"æ¡ä»¶æˆ–è€…"filter"æ¡ä»¶å†…, æ­¤æ—¶ä¸è¦æ±‚æ»¡è¶³"should"æ¡ä»¶, ä½†æ˜¯ä¼šå½±å“åˆ°æŸ¥è¯¢åˆ†æ•°</span><br><span class="line">      // æƒ…å†µäºŒ(å•æ¡bool): å½“"should"æ¡ä»¶ä¸åœ¨"must"æ¡ä»¶æˆ–è€…"filter"æ¡ä»¶å†…, é»˜è®¤æƒ…å†µè‡³å°‘æœ‰ä¸€ä¸ª"should"å­å¥éœ€è¦æ»¡è¶³(å¯é€šè¿‡é…ç½®`minimum_should_match`å‚æ•°è¿›è¡Œå˜æ›´)</span><br><span class="line">      "should": [</span><br><span class="line">        &#123; <span class="attr">"range"</span>: &#123;<span class="attr">"age"</span> : &#123; <span class="attr">"gte"</span> : <span class="number">10</span>, <span class="attr">"lte"</span> : <span class="number">20</span> &#125;&#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      "minimum_should_match": 1,</span><br><span class="line">      // The clause (query) must not appear in the matching documents. Clauses are executed in filter context meaning that scoring is ignored and clauses are considered for caching. Because scoring is ignored, a score of 0 for all documents is returned.</span><br><span class="line">      // æ‰€æœ‰"must_not"æ¡ä»¶ä¸èƒ½åŒ¹é…æˆåŠŸ</span><br><span class="line">      "must_not": [</span><br><span class="line">        &#123; "term": &#123; "tag" : "wow" &#125;&#125;,</span><br><span class="line">        &#123; <span class="attr">"term"</span>: &#123; <span class="attr">"tag"</span> : <span class="string">"elasticsearch"</span> &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="å…¨æ–‡æœç´¢"><a href="#å…¨æ–‡æœç´¢" class="headerlink" title="å…¨æ–‡æœç´¢"></a>å…¨æ–‡æœç´¢</h3><blockquote>
<p>ä¼šèµ°åˆ†æå™¨</p>
<ul>
<li>match<br>æè¿°: åŒ¹é…æŸ¥è¯¢, åªéœ€åŒ…å«éƒ¨åˆ†ã€‚eg: hello world, åªåŒ¹é…â€helloâ€æˆ–è€…â€worldâ€<br>å¯æ¥å—ç±»å‹: text/numerics/dates<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">// ç®€å•æŸ¥è¯¢</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"message"</span> : <span class="string">"this is a test"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// å¤æ‚æŸ¥è¯¢</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"message"</span> : &#123;</span><br><span class="line">                <span class="attr">"query"</span>: <span class="string">"this is a test"</span>,</span><br><span class="line">                <span class="attr">"å‚æ•°"</span>: <span class="string">"å€¼"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ul>
<li><p>match_phrase</p>
<blockquote>
<p>æè¿°: åŒ¹é…è¯ç»„æŸ¥è¯¢, å¤šä¸ªè¯ä¸€èµ·è¢«æŸ¥è¯¢. eg: hello world, åŒ¹é…â€hello worldâ€</p>
</blockquote>
</li>
<li><p>match_phrase_prefix</p>
<blockquote>
<p>æè¿°: åŒ<code>match_phrase</code>ä½†æ˜¯æœ€åä¸€ä¸ªè¯ä¼šè¢«å½“ä½œå‰ç¼€å»åŒ¹é…. eg: hello wo, å¯åŒ¹é…åˆ°â€hello worldâ€</p>
</blockquote>
</li>
<li><p>multi_match</p>
<blockquote>
<p>æè¿°: åŒ<code>match</code>ä½†æ˜¯å¯ä»¥ä½œç”¨åœ¨å¤šä¸ªå­—æ®µä¸Šï¼Œä¸”å­—æ®µæ”¯æŒè¡¨è¾¾å¼</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"multi_match"</span> : &#123;</span><br><span class="line">      <span class="attr">"query"</span>:    <span class="string">"this is a test"</span>, </span><br><span class="line">      <span class="attr">"fields"</span>: [ <span class="string">"subject"</span>, <span class="string">"*_name"</span> ],</span><br><span class="line">      <span class="attr">"å‚æ•°"</span>: <span class="string">"å€¼"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>common</p>
<blockquote>
<p>æè¿°: æ ¹æ®è¯é¢‘è¿›è¡ŒåŒ¹é….</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"common"</span>: &#123;</span><br><span class="line">            <span class="attr">"body"</span>: &#123;</span><br><span class="line">                <span class="attr">"query"</span>: <span class="string">"this is bonsai cool"</span>,</span><br><span class="line">                // è¯é¢‘ç‡: [0, 1]</span><br><span class="line">                "cutoff_frequency": 0.001</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>query_string<blockquote>
<p>æè¿°: æ ¹æ®è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…, è¾“å…¥çš„å€¼ä¸ºè¡¨è¾¾å¼, æ”¯æŒä¸€äº›å†…ç½®å‚æ•°å’Œè¯­æ³•ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"query_string"</span>: &#123;</span><br><span class="line">            <span class="attr">"query"</span>: <span class="string">"(content:this OR name:this) AND (content:that OR name:that)"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>simple_query_string<blockquote>
<p>æè¿°: ä¸<code>query_string</code>ç±»ä¼¼, æ”¯æŒä¸€äº›æ›´ç®€ä¾¿çš„ç¬¦å·ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"simple_query_string"</span> : &#123;</span><br><span class="line">        <span class="attr">"query"</span>: <span class="string">"\"fried eggs\" +(eggplant | potato) -frittata"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [<span class="string">"title^5"</span>, <span class="string">"body"</span>],</span><br><span class="line">        <span class="attr">"default_operator"</span>: <span class="string">"and"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h3><blockquote>
<p>ç²¾å‡†æœç´¢<br>ä¸€èˆ¬ç”¨äºç»“æ„åŒ–æ•°æ®è€Œéå…¨æ–‡åŒ¹é…: numbers, dates, and enums</p>
</blockquote>
<ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="external">term</a></p>
<blockquote>
<p>æè¿°: åŒ¹é…å•ä¸ªå€¼, ç±»ä¼¼â€=â€, ä½†æ˜¯å…¶å…·å¤‡<code>Elasticsearch</code>çš„ç‰¹æ€§å¦‚: åˆ†æ•°</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// ç®€å•</span><br><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"Kimchy"</span> &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// å¤æ‚ï¼Œè®¾å®šåŒ¹é…åˆ†æ•°ä¹‹ç±»çš„</span><br><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"should"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"term"</span>: &#123;</span><br><span class="line">            <span class="attr">"status"</span>: &#123;</span><br><span class="line">              <span class="attr">"value"</span>: <span class="string">"urgent"</span>,</span><br><span class="line">              <span class="attr">"boost"</span>: <span class="number">2.0</span> </span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"term"</span>: &#123;</span><br><span class="line">            <span class="attr">"status"</span>: <span class="string">"normal"</span> </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="external">terms</a></p>
<blockquote>
<p>æè¿°: åŒ¹é…å¤šä¸ªå€¼, ç±»ä¼¼â€inâ€</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// ç®€å•</span><br><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"terms"</span> : &#123; <span class="attr">"user"</span> : [<span class="string">"kimchy"</span>, <span class="string">"elasticsearch"</span>]&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-set-query.html" target="_blank" rel="external">terms_set</a><blockquote>
<p>æè¿°: å®šåˆ¶åŒ–åŒ¹é…è§„åˆ™</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /my-index/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"terms_set"</span>: &#123;</span><br><span class="line">            <span class="attr">"codes"</span> : &#123;</span><br><span class="line">                <span class="attr">"terms"</span> : [<span class="string">"abc"</span>, <span class="string">"def"</span>, <span class="string">"ghi"</span>],</span><br><span class="line">                <span class="attr">"minimum_should_match_field"</span>: <span class="string">"required_matches"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="external">range</a><blockquote>
<p>æè¿°: èŒƒå›´åŒ¹é…, æ”¯æŒ: stringï¼Œdateï¼Œnumeric</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"range"</span> : &#123;</span><br><span class="line">            <span class="attr">"age"</span> : &#123;</span><br><span class="line">                <span class="attr">"gte"</span> : <span class="number">10</span>,</span><br><span class="line">                <span class="attr">"lte"</span> : <span class="number">20</span>,</span><br><span class="line">                <span class="attr">"boost"</span> : <span class="number">2.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="external">exists</a><blockquote>
<p>æè¿°: å­˜åœ¨æŸ¥è¯¢, å¿…é¡»è‡³å°‘å­˜åœ¨ä¸€ä¸ªé<code>null</code>å€¼. eg: user: [null, â€˜hocginâ€™]</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"exists"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"user"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html" target="_blank" rel="external">prefix</a><blockquote>
<p>æè¿°: å‰ç¼€åŒ¹é….</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123; <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki"</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="external">wildcard</a></p>
<blockquote>
<p>æè¿°: é€šé…ç¬¦åŒ¹é…ã€‚ç±»ä¼¼<code>like</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"wildcard"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki*y"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="external">regexp</a></p>
<blockquote>
<p>æè¿°: æ­£åˆ™åŒ¹é…ï¼Œå…è®¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚<br>âš ï¸: æ€§èƒ½å–å†³äºæ­£åˆ™è¡¨è¾¾å¼å†™æ³•ï¼Œå»ºè®®ç”¨<code>é¥¥é¥¿æ¨¡å¼</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"regexp"</span>:&#123;</span><br><span class="line">            <span class="attr">"name.first"</span>: <span class="string">"s.*y?"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="external">fuzzy</a><blockquote>
<p>æè¿°: æ¨¡ç³ŠæŸ¥è¯¢. é€‚ç”¨äºæ‹¼å†™é”™è¯¯æ—¶æœç´¢ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">       <span class="attr">"fuzzy"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="external">type</a><blockquote>
<p>æè¿°: æ–‡æ¡£ç±»å‹æŸ¥è¯¢</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span> : &#123;</span><br><span class="line">            <span class="attr">"value"</span> : <span class="string">"_doc"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="external">ids</a><blockquote>
<p>æè¿°: æ ¹æ®<code>id</code>å­—æ®µè¿‡æ»¤æ–‡æ¡£æ•°æ®</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"ids"</span> : &#123;</span><br><span class="line">            <span class="attr">"type"</span> : <span class="string">"_doc"</span>,</span><br><span class="line">            <span class="attr">"values"</span> : [<span class="string">"1"</span>, <span class="string">"4"</span>, <span class="string">"100"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¤åˆæŸ¥è¯¢"><a href="#å¤åˆæŸ¥è¯¢" class="headerlink" title="å¤åˆæŸ¥è¯¢"></a>å¤åˆæŸ¥è¯¢</h3><ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-constant-score-query.html#query-dsl-constant-score-query" target="_blank" rel="external">constant_score</a></p>
<blockquote>
<p>æè¿°: å¿½ç•¥è¯„åˆ†æŸ¥è¯¢, æŸ¥è¯¢é€Ÿåº¦æ›´å¿«(ä½¿ç”¨ç¼“å­˜)ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"constant_score"</span> : &#123;</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span>&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"boost"</span> : <span class="number">1.2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" target="_blank" rel="external">Bool æŸ¥è¯¢</a></p>
<blockquote>
<p>æè¿°: ä½¿ç”¨å…¶ä»–æŸ¥è¯¢çš„boolå€¼ç»„åˆçš„æŸ¥è¯¢ã€‚è¯¦ç»†å‚è€ƒ<code>æ¦‚è¦</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span> : &#123;</span><br><span class="line">      <span class="attr">"must"</span> : &#123;</span><br><span class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"filter"</span>: &#123;</span><br><span class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"tech"</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"must_not"</span> : &#123;</span><br><span class="line">        <span class="attr">"range"</span> : &#123;</span><br><span class="line">          <span class="attr">"age"</span> : &#123; <span class="attr">"gte"</span> : <span class="number">10</span>, <span class="attr">"lte"</span> : <span class="number">20</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"should"</span> : [</span><br><span class="line">        &#123; <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"wow"</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"elasticsearch"</span> &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"minimum_should_match"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"boost"</span> : <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-dis-max-query.html" target="_blank" rel="external">Dis Max Query</a><blockquote>
<p>æè¿°: å–å¤šä¸ªæ¡ä»¶æŸ¥è¯¢ç»“æœä¸­ï¼Œå¾—åˆ†æœ€é«˜çš„æŸ¥è¯¢ç»“æœã€‚å¯ä»¥é€šè¿‡: <code>tie_breaker</code> æ¥å…³è”å…¶ä»–æŸ¥è¯¢ç»“æœçš„åˆ†æ•°ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"dis_max"</span> : &#123;</span><br><span class="line">            // æ­¤å¤„ç›¸å½“äºé™¤æœ€ä½³åŒ¹é…å¤–ï¼Œå…¶ä»–åŒ¹é…ç»“æœçš„å‚ä¸ç¨‹åº¦.   --- è¨€å¤–ä¹‹æ„, å¤šæ–¹é¢è€ƒè™‘</span><br><span class="line">            "tie_breaker" : 0.7,</span><br><span class="line">            "boost" : 1.2,</span><br><span class="line">            "queries" : [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"term"</span> : &#123; <span class="attr">"age"</span> : <span class="number">34</span> &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"term"</span> : &#123; <span class="attr">"age"</span> : <span class="number">35</span> &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html" target="_blank" rel="external">Function Score Query</a></p>
<blockquote>
<p>æè¿°: æ‰“åˆ†å™¨. æœ€åæ‰“åˆ†é˜¶æ®µï¼Œå¼•å…¥ä¸€äº›æœ€ä½³å€¼çš„è®¡ç®—æ–¹å¼.         â€” è¨€å¤–ä¹‹æ„ï¼Œä½œå¼Šå™¨</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"function_score"</span>: &#123;</span><br><span class="line">            <span class="attr">"query"</span>: &#123; <span class="attr">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">            <span class="attr">"boost"</span>: <span class="string">"5"</span>,</span><br><span class="line">            <span class="attr">"random_score"</span>: &#123;&#125;, </span><br><span class="line">            <span class="attr">"boost_mode"</span>:<span class="string">"multiply"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-boosting-query.html" target="_blank" rel="external">Boosting Query</a></p>
<blockquote>
<p>æè¿°: è®¾ç½®æ¡ä»¶çš„æƒé‡.</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"boosting"</span> : &#123;</span><br><span class="line">            <span class="attr">"positive"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123;</span><br><span class="line">                    <span class="attr">"field1"</span> : <span class="string">"value1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"negative"</span> : &#123;</span><br><span class="line">                 <span class="attr">"term"</span> : &#123;</span><br><span class="line">                     <span class="attr">"field2"</span> : <span class="string">"value2"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"negative_boost"</span> : <span class="number">0.2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿æ¥æŸ¥è¯¢"><a href="#è¿æ¥æŸ¥è¯¢" class="headerlink" title="è¿æ¥æŸ¥è¯¢"></a>è¿æ¥æŸ¥è¯¢</h3><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html#query-dsl-nested-query" target="_blank" rel="external">Nested Query</a><blockquote>
<p>æè¿°</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"nested"</span> : &#123;</span><br><span class="line">            // åµŒå¥—å¯¹è±¡è·¯å¾„</span><br><span class="line">            "path" : "obj1",</span><br><span class="line">            // å½±å“çš„è®¡åˆ†æ–¹å¼</span><br><span class="line">            "score_mode" : "avg",</span><br><span class="line">            "query" : &#123;</span><br><span class="line">                "bool" : &#123;</span><br><span class="line">                    "must" : [</span><br><span class="line">                        // âš ï¸: å­—æ®µå¿…é¡»æ˜¯å®Œæ•´è·¯å¾„</span><br><span class="line">                    &#123; "match" : &#123;"obj1.name" : "blue"&#125; &#125;,</span><br><span class="line">                    &#123; <span class="attr">"range"</span> : &#123;<span class="attr">"obj1.count"</span> : &#123;<span class="attr">"gt"</span> : <span class="number">5</span>&#125;&#125; &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-child-query.html" target="_blank" rel="external">Has Child Query</a><blockquote>
<p>æè¿°: è¿›è¡Œå­æ–‡æ¡£æŸ¥è¯¢, è¿”å›çˆ¶æ–‡æ¡£. æ…¢æŸ¥è¯¢ï¼Œæ…ç”¨</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"has_child"</span> : &#123;</span><br><span class="line">            <span class="attr">"type"</span> : <span class="string">"blog_tag"</span>,</span><br><span class="line">            <span class="attr">"score_mode"</span> : <span class="string">"min"</span>,</span><br><span class="line">            <span class="attr">"query"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123;</span><br><span class="line">                    <span class="attr">"tag"</span> : <span class="string">"something"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-parent-query.html" target="_blank" rel="external">Has Parent Query</a><blockquote>
<p>æè¿°: çˆ¶æ–‡æ¡£æŸ¥è¯¢ï¼Œè¿”å›å­æ–‡æ¡£. </p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"has_parent"</span> : &#123;</span><br><span class="line">            <span class="attr">"parent_type"</span> : <span class="string">"blog"</span>,</span><br><span class="line">            <span class="attr">"query"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123;</span><br><span class="line">                    <span class="attr">"tag"</span> : <span class="string">"something"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="">Parent Id Query</a><blockquote>
<p>æè¿°: çˆ¶IDæŸ¥è¯¢ï¼Œè¿”å›å­æ–‡æ¡£</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"parent_id"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"my_child"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="åœ°ç†ä½ç½®æŸ¥è¯¢"><a href="#åœ°ç†ä½ç½®æŸ¥è¯¢" class="headerlink" title="åœ°ç†ä½ç½®æŸ¥è¯¢"></a>åœ°ç†ä½ç½®æŸ¥è¯¢</h3><blockquote>
<p>éœ€è¦<code>geo_shape</code>ç±»å‹</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-shape-query.html" target="_blank" rel="external">GeoShape Query</a><br>æè¿°: GeoShape æŸ¥è¯¢ï¼ŒæŸ¥è¯¢åœ¨å¤šè¾¹å½¢(åŸºäºGeoJSON)å†…çš„ç‚¹ã€‚æ—¢: ç”¨ä¸€ä¸ªå¤šè¾¹å½¢å»æœç´¢ã€‚</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /example/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>:&#123;</span><br><span class="line">        <span class="attr">"bool"</span>: &#123;</span><br><span class="line">            <span class="attr">"must"</span>: &#123;</span><br><span class="line">                <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span>: &#123;</span><br><span class="line">                <span class="attr">"geo_shape"</span>: &#123;</span><br><span class="line">                    <span class="attr">"location"</span>: &#123;</span><br><span class="line">                        <span class="attr">"shape"</span>: &#123;</span><br><span class="line">                            <span class="attr">"type"</span>: <span class="string">"envelope"</span>,</span><br><span class="line">                            <span class="attr">"coordinates"</span> : [[<span class="number">13.0</span>, <span class="number">53.0</span>], [<span class="number">14.0</span>, <span class="number">52.0</span>]]</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"relation"</span>: <span class="string">"within"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-bounding-box-query.html#query-dsl-geo-bounding-box-query" target="_blank" rel="external">Geo Bounding Box Query</a><blockquote>
<p>æè¿°: åœ°ç†è¾¹ç•Œæ¡†æŸ¥è¯¢ï¼Œå³ç”¨ä¸€ä¸ªè¾¹ç•ŒèŒƒå›´å»æœç´¢ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"must"</span> : &#123;</span><br><span class="line">                <span class="attr">"match_all"</span> : &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"geo_bounding_box"</span> : &#123;</span><br><span class="line">                    <span class="attr">"pin.location"</span> : &#123;</span><br><span class="line">                        <span class="attr">"top_left"</span> : &#123;</span><br><span class="line">                            <span class="attr">"lat"</span> : <span class="number">40.73</span>,</span><br><span class="line">                            <span class="attr">"lon"</span> : <span class="number">-74.1</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"bottom_right"</span> : &#123;</span><br><span class="line">                            <span class="attr">"lat"</span> : <span class="number">40.01</span>,</span><br><span class="line">                            <span class="attr">"lon"</span> : <span class="number">-71.12</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-distance-query.html" target="_blank" rel="external">Geo Distance Query</a><blockquote>
<p>æè¿°: åœ°ç†è·ç¦»æŸ¥è¯¢</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /my_locations/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"must"</span> : &#123;</span><br><span class="line">                <span class="attr">"match_all"</span> : &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"geo_distance"</span> : &#123;</span><br><span class="line">                    <span class="attr">"distance"</span> : <span class="string">"200km"</span>,</span><br><span class="line">                    <span class="attr">"pin.location"</span> : &#123;</span><br><span class="line">                        <span class="attr">"lat"</span> : <span class="number">40</span>,</span><br><span class="line">                        <span class="attr">"lon"</span> : <span class="number">-70</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-polygon-query.html" target="_blank" rel="external">Geo Polygon Query</a><blockquote>
<p>æè¿°: åœ°ç†å¤šè¾¹å½¢æŸ¥è¯¢, è¿”å›å›´æ å†…çš„æ•°æ®</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"must"</span> : &#123;</span><br><span class="line">                <span class="attr">"match_all"</span> : &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"geo_polygon"</span> : &#123;</span><br><span class="line">                    <span class="attr">"person.location"</span> : &#123;</span><br><span class="line">                        <span class="attr">"points"</span> : [</span><br><span class="line">                            &#123;<span class="attr">"lat"</span> : <span class="number">40</span>, <span class="attr">"lon"</span> : <span class="number">-70</span>&#125;,</span><br><span class="line">                            &#123;<span class="attr">"lat"</span> : <span class="number">30</span>, <span class="attr">"lon"</span> : <span class="number">-80</span>&#125;,</span><br><span class="line">                            &#123;<span class="attr">"lat"</span> : <span class="number">20</span>, <span class="attr">"lon"</span> : <span class="number">-90</span>&#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å®šåˆ¶åŒ–æŸ¥è¯¢"><a href="#å®šåˆ¶åŒ–æŸ¥è¯¢" class="headerlink" title="å®šåˆ¶åŒ–æŸ¥è¯¢"></a>å®šåˆ¶åŒ–æŸ¥è¯¢</h3><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html" target="_blank" rel="external">More Like This Query</a><blockquote>
<p>æè¿°: æ ¹æ®å­—æ®µè¿›è¡ŒåŒ¹é…æ–‡å­—çš„ç›¸è¯†åº¦ï¼Œä¸€èˆ¬ç”¨äºè¿›è¡Œæ–‡ç« æˆ–å†…å®¹çš„ç›¸è¯†åº¦æ¨è</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"more_like_this"</span> : &#123;</span><br><span class="line">            <span class="attr">"fields"</span> : [<span class="string">"title"</span>, <span class="string">"description"</span>],</span><br><span class="line">            <span class="attr">"like"</span> : <span class="string">"Once upon a time"</span>,</span><br><span class="line">            <span class="attr">"min_term_freq"</span> : <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"max_query_terms"</span> : <span class="number">12</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-script-query.html" target="_blank" rel="external">Script Query</a><blockquote>
<p>æè¿°: è„šæœ¬æŸ¥è¯¢ï¼Œä½¿ç”¨ç‰¹å®šçš„è¯­æ³•è„šæœ¬è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"script"</span> : &#123;</span><br><span class="line">                    <span class="attr">"script"</span> : &#123;</span><br><span class="line">                        <span class="attr">"source"</span>: <span class="string">"doc['num1'].value &gt; 1"</span>,</span><br><span class="line">                        <span class="attr">"lang"</span>: <span class="string">"painless"</span></span><br><span class="line">                     &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-percolate-query.html" target="_blank" rel="external">Percolate Query</a><blockquote>
<p>æè¿°: PercolateæŸ¥è¯¢ï¼Œå¯ç”¨äºåŒ¹é…å­˜å‚¨åœ¨ç´¢å¼•ä¸­çš„æŸ¥è¯¢, </p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /my-index/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"percolate"</span> : &#123;</span><br><span class="line">            <span class="attr">"field"</span> : <span class="string">"query"</span>,</span><br><span class="line">            <span class="attr">"document"</span> : &#123;</span><br><span class="line">                <span class="attr">"message"</span> : <span class="string">"A new bonsai tree in the office"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wrapper-query.html" target="_blank" rel="external">Wrapper Query</a><blockquote>
<p>æè¿°: åŒ…è£…å™¨æŸ¥è¯¢, å°†æŸ¥è¯¢æ¡ä»¶å­—ç¬¦ä¸² base64 ç¼–ç </p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"wrapper"</span>: &#123;</span><br><span class="line">            // &#123;"term" : &#123; "user" : "Kimchy" &#125;&#125;</span><br><span class="line">            "query" : "eyJ0ZXJtIiA6IHsgInVzZXIiIDogIktpbWNoeSIgfX0=" </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="è·¨åº¦æŸ¥è¯¢"><a href="#è·¨åº¦æŸ¥è¯¢" class="headerlink" title="è·¨åº¦æŸ¥è¯¢"></a>è·¨åº¦æŸ¥è¯¢</h3><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-term-query.html" target="_blank" rel="external">Span Term Query</a><blockquote>
<p>æè¿°: ç­‰ä»·äº<code>term</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-multi-term-query.html" target="_blank" rel="external">Span Multi Term Query</a><blockquote>
<p>æè¿°: å¤šä¸ªè·¨åº¦æŸ¥è¯¢ç»„åˆ, å…è®¸ (wildcard, fuzzy, prefix, range or regexp query) ä¹‹ä¸€</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_multi"</span>:&#123;</span><br><span class="line">            <span class="attr">"match"</span>:&#123;</span><br><span class="line">                <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> :  &#123; <span class="attr">"value"</span> : <span class="string">"ki"</span>, <span class="attr">"boost"</span> : <span class="number">1.08</span> &#125; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-first-query.html#query-dsl-span-first-query" target="_blank" rel="external">Span First Query</a><blockquote>
<p>æè¿°: è·¨åº¦ä¼˜å…ˆæŸ¥è¯¢ï¼Œ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_first"</span> : &#123;</span><br><span class="line">            <span class="attr">"match"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"end"</span> : <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-near-query.html" target="_blank" rel="external">Span Near Query</a><blockquote>
<p>æè¿°: æ¥å—å¤šä¸ªè·¨åº¦æŸ¥è¯¢ï¼Œå…¶åŒ¹é…å¿…é¡»åœ¨å½¼æ­¤çš„æŒ‡å®šè·ç¦»å†…ï¼Œå¹¶ä¸”å¯èƒ½ä»¥ç›¸åŒçš„é¡ºåºã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">            <span class="attr">"clauses"</span> : [</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value1"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value2"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value3"</span> &#125; &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"slop"</span> : <span class="number">12</span>,</span><br><span class="line">            <span class="attr">"in_order"</span> : <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-or-query.html" target="_blank" rel="external">Span Or Query</a><blockquote>
<p>æè¿°: ç»„åˆå¤šä¸ªè·¨åº¦æŸ¥è¯¢ - è¿”å›ä¸ä»»ä½•æŒ‡å®šæŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_or"</span> : &#123;</span><br><span class="line">            <span class="attr">"clauses"</span> : [</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value1"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value2"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value3"</span> &#125; &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-not-query.html" target="_blank" rel="external">Span Not Query</a><blockquote>
<p>æè¿°: åŒ…è£…å¦ä¸€ä¸ªspanæŸ¥è¯¢ï¼Œå¹¶æ’é™¤ä¸è¯¥æŸ¥è¯¢åŒ¹é…çš„ä»»ä½•æ–‡æ¡£ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_not"</span> : &#123;</span><br><span class="line">            <span class="attr">"include"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"hoya"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"exclude"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">                    <span class="attr">"clauses"</span> : [</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"la"</span> &#125; &#125;,</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"hoya"</span> &#125; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"slop"</span> : <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">"in_order"</span> : <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-containing-query.html" target="_blank" rel="external">Span Containing Query</a><blockquote>
<p>æè¿°: æ¥å—è·¨åº¦æŸ¥è¯¢åˆ—è¡¨ï¼Œä½†ä»…è¿”å›ä¸ç¬¬äºŒä¸ªè·¨åº¦æŸ¥è¯¢åŒ¹é…çš„è·¨åº¦ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/_search" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_containing"</span> : &#123;</span><br><span class="line">            <span class="attr">"little"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"foo"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"big"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">                    <span class="attr">"clauses"</span> : [</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"bar"</span> &#125; &#125;,</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"baz"</span> &#125; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"slop"</span> : <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">"in_order"</span> : <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-within-query.html" target="_blank" rel="external">Span Within Query</a><blockquote>
<p>æè¿°: åªè¦å…¶è·¨åº¦è½åœ¨ç”±å…¶ä»–è·¨åº¦æŸ¥è¯¢åˆ—è¡¨è¿”å›çš„è·¨åº¦å†…ï¼Œå°±ä¼šè¿”å›å•è·¨åº¦æŸ¥è¯¢çš„ç»“æœã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/_search" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_within"</span> : &#123;</span><br><span class="line">            <span class="attr">"little"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"foo"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"big"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">                    <span class="attr">"clauses"</span> : [</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"bar"</span> &#125; &#125;,</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"baz"</span> &#125; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"slop"</span> : <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">"in_order"</span> : <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-field-masking-query.html" target="_blank" rel="external">Span Field Masking Query</a><blockquote>
<p>æè¿°: å…è®¸æŸ¥è¯¢ä¸åŒçš„å­—æ®µspan-nearæˆ–span-orè·¨ä¸åŒå­—æ®µã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/_search" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"span_near"</span>: &#123;</span><br><span class="line">      <span class="attr">"clauses"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"span_term"</span>: &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"quick brown"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"field_masking_span"</span>: &#123;</span><br><span class="line">            <span class="attr">"query"</span>: &#123;</span><br><span class="line">              <span class="attr">"span_term"</span>: &#123;</span><br><span class="line">                <span class="attr">"text.stems"</span>: <span class="string">"fox"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"text"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"slop"</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"in_order"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><blockquote>
<p>elasticsearch-plugin install {url}</p>
<ul>
<li><a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="external">ä¸­æ–‡åˆ†è¯æ’ä»¶</a></li>
</ul>
</blockquote>
<hr>
<h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="external">ElasticSearch å®˜æ–¹æ–‡æ¡£</a><br><a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="external">å…¨æ–‡æœç´¢å¼•æ“ Elasticsearch å…¥é—¨æ•™ç¨‹</a></p>

            
    <div class="article-tag">
        <a class="tag-link" href="/tags/Elasticsearch/">Elasticsearch</a>
    </div>

            

        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="https://hocg.in/2019/03/23/Elasticsearch éšæ‰‹è®°/" data-id="ck2srtwtk00b9etavtjz1ah62" class="article-share-link"><i class="fa fa-share"></i>åˆ†äº«åˆ°</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
    
<nav id="article-nav">
    
        <a href="/2019/04/01/Linux ä¸‹ç½‘ç»œç›¸å…³çš„å‘½ä»¤/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
            <div class="article-nav-title">
                
                    Linux ä¸‹ç½‘ç»œç›¸å…³çš„å‘½ä»¤
                
            </div>
        </a>
    
    
        <a href="/2019/03/08/k8sä¸kubeadmä½¿ç”¨çš„ä¸€äº›è®°å½•/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
            <div class="article-nav-title">K8s ä¸ kubeadm ä½¿ç”¨çš„ä¸€äº›è®°å½•</div>
        </a>
    
</nav>


    
</article>



    
        <section id="comments">
    <div id="valine-thread"></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        <div class="widget-wrap">
    <h3 class="widget-title">å…³æ³¨æˆ‘</h3>
    <div class="widget">
        <a class="social" href="https://github.com/hocgin" target="_blank"><i class="fa fa-github fa-2x"></i></a>
        <a class="social" href="https://weibo.com/u/2006617153" target="_blank"><i class="fa fa-weibo fa-2x"></i></a>
        <a class="social" href="https://www.500px.com/hocgin" target="_blank"><i class="fa fa-500px fa-2x"></i></a>
        <a class="social" href="https://hocg.in/atom.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>
        <a class="social" href="https://hocg.in/Resume" target="_blank"><span class="fa-2x">ç®€</span></a>
    </div>
</div>
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">è¿‘æœŸæ–‡ç« </h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/Web/">Web</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/04/18/å…³äºç½‘çº¦è½¦æ ¸å¿ƒä¸šåŠ¡-æ¨å•ç›¸å…³æ•´ç†/" class="title">å…³äºç½‘çº¦è½¦æ ¸å¿ƒä¸šåŠ¡-æ¨å•ç›¸å…³è®¾è®¡æ•´ç†</a></p>
                            <!--<p class="item-date"><time datetime="2019-04-18T10:20:20.000Z" itemprop="datePublished">2019-04-18</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/Linux/">Linux</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/04/01/Linux ä¸‹ç½‘ç»œç›¸å…³çš„å‘½ä»¤/" class="title">Linux ä¸‹ç½‘ç»œç›¸å…³çš„å‘½ä»¤</a></p>
                            <!--<p class="item-date"><time datetime="2019-04-01T00:07:00.000Z" itemprop="datePublished">2019-04-01</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/æœåŠ¡ç«¯/">æœåŠ¡ç«¯</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/03/23/Elasticsearch éšæ‰‹è®°/" class="title">Elasticsearch éšæ‰‹è®°</a></p>
                            <!--<p class="item-date"><time datetime="2019-03-23T05:53:00.000Z" itemprop="datePublished">2019-03-23</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/K8s/">K8s</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/03/08/k8sä¸kubeadmä½¿ç”¨çš„ä¸€äº›è®°å½•/" class="title">K8s ä¸ kubeadm ä½¿ç”¨çš„ä¸€äº›è®°å½•</a></p>
                            <!--<p class="item-date"><time datetime="2019-03-08T01:13:00.000Z" itemprop="datePublished">2019-03-08</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/02/02/å¦‚ä½•åšå•å…ƒæµ‹è¯•/" class="title">å¦‚ä½•åšå•å…ƒæµ‹è¯•</a></p>
                            <!--<p class="item-date"><time datetime="2019-02-02T05:17:21.000Z" itemprop="datePublished">2019-02-02</time></p>-->
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
<div class="widget-wrap" id="widget-toc">
    <h3 class="widget-title">
        æ–‡ç« ç›®å½•
    </h3>
    <div class="widget">
        <!--toc-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
            <div class="post-toc">
                <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch-å¯¹æ¯”-MySQL"><span class="nav-number">1.</span> <span class="nav-text">ElasticSearch å¯¹æ¯” MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç´¢å¼•æ¨¡ç‰ˆæ•°æ®ç±»å‹"><span class="nav-number">2.</span> <span class="nav-text">ç´¢å¼•æ¨¡ç‰ˆæ•°æ®ç±»å‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API-æ¥å£"><span class="nav-number">3.</span> <span class="nav-text">API æ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç›‘æ§æ“ä½œ"><span class="nav-number">3.1.</span> <span class="nav-text">ç›‘æ§æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#èŠ‚ç‚¹æ“ä½œ"><span class="nav-number">3.2.</span> <span class="nav-text">èŠ‚ç‚¹æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ•°æ®æ“ä½œ"><span class="nav-number">3.3.</span> <span class="nav-text">æ•°æ®æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆ†ææ“ä½œ"><span class="nav-number">3.4.</span> <span class="nav-text">åˆ†ææ“ä½œ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-è°ƒç”¨"><span class="nav-number">4.</span> <span class="nav-text">Java è°ƒç”¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSONæ ¼å¼æŸ¥è¯¢è¯­æ³•"><span class="nav-number">5.</span> <span class="nav-text">JSONæ ¼å¼æŸ¥è¯¢è¯­æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¦‚è¦"><span class="nav-number">5.1.</span> <span class="nav-text">æ¦‚è¦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…¨æ–‡æœç´¢"><span class="nav-number">5.2.</span> <span class="nav-text">å…¨æ–‡æœç´¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¡ä»¶æŸ¥è¯¢"><span class="nav-number">5.3.</span> <span class="nav-text">æ¡ä»¶æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¤åˆæŸ¥è¯¢"><span class="nav-number">5.4.</span> <span class="nav-text">å¤åˆæŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿æ¥æŸ¥è¯¢"><span class="nav-number">5.5.</span> <span class="nav-text">è¿æ¥æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ°ç†ä½ç½®æŸ¥è¯¢"><span class="nav-number">5.6.</span> <span class="nav-text">åœ°ç†ä½ç½®æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®šåˆ¶åŒ–æŸ¥è¯¢"><span class="nav-number">5.7.</span> <span class="nav-text">å®šåˆ¶åŒ–æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·¨åº¦æŸ¥è¯¢"><span class="nav-number">5.8.</span> <span class="nav-text">è·¨åº¦æŸ¥è¯¢</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ’ä»¶"><span class="nav-number">6.</span> <span class="nav-text">æ’ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ–‡æ¡£"><span class="nav-number">7.</span> <span class="nav-text">æ–‡æ¡£</span></a></li></ol>
            </div>
        </section>
        <!--/toc-->
    </div>
</div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">å½’æ¡£</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">å››æœˆ 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">ä¸‰æœˆ 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">äºŒæœˆ 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">ä¸€æœˆ 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">åäºŒæœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">åä¸€æœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">ä¸ƒæœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">å…­æœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">ä¸‰æœˆ 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">äºŒæœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">ä¸€æœˆ 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">åä¸€æœˆ 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">åæœˆ 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">ä¹æœˆ 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">ä¸ƒæœˆ 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">å…­æœˆ 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">äº”æœˆ 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">å››æœˆ 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">ä¸‰æœˆ 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">äºŒæœˆ 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">ä¸€æœˆ 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">åæœˆ 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">ä¹æœˆ 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">å…«æœˆ 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">ä¸ƒæœˆ 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">å…­æœˆ 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">äº”æœˆ 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">å››æœˆ 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">ä¸‰æœˆ 2016</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
        <div class="widget tagcloud">
            <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/CSS3/" style="font-size: 10px;">CSS3</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/DevOps/" style="font-size: 10px;">DevOps</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/GitLab/" style="font-size: 10px;">GitLab</a> <a href="/tags/Gnome/" style="font-size: 10px;">Gnome</a> <a href="/tags/Go/" style="font-size: 10px;">Go</a> <a href="/tags/Google/" style="font-size: 10px;">Google</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Hexo/" style="font-size: 11.25px;">Hexo</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/JAVA/" style="font-size: 10px;">JAVA</a> <a href="/tags/JVM/" style="font-size: 11.25px;">JVM</a> <a href="/tags/Java/" style="font-size: 18.75px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 12.5px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Mac/" style="font-size: 12.5px;">Mac</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/Nexus/" style="font-size: 10px;">Nexus</a> <a href="/tags/Ngrok/" style="font-size: 10px;">Ngrok</a> <a href="/tags/NodeJS/" style="font-size: 12.5px;">NodeJS</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/Oh-My-ZSH/" style="font-size: 10px;">Oh My ZSH</a> <a href="/tags/OpenWrt/" style="font-size: 16.25px;">OpenWrt</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/Pjax/" style="font-size: 10px;">Pjax</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/Shell/" style="font-size: 11.25px;">Shell</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/SpringBoot/" style="font-size: 10px;">SpringBoot</a> <a href="/tags/TCP-IP/" style="font-size: 10px;">TCP/IP</a> <a href="/tags/Thymeleaf/" style="font-size: 10px;">Thymeleaf</a> <a href="/tags/Tip/" style="font-size: 10px;">Tip</a> <a href="/tags/Tips/" style="font-size: 20px;">Tips</a> <a href="/tags/Ubuntu/" style="font-size: 17.5px;">Ubuntu</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Wireshark/" style="font-size: 10px;">Wireshark</a> <a href="/tags/å‰ç«¯/" style="font-size: 11.25px;">å‰ç«¯</a> <a href="/tags/å›¾ç‰‡å¢™/" style="font-size: 10px;">å›¾ç‰‡å¢™</a> <a href="/tags/å¤šçº¿ç¨‹/" style="font-size: 13.75px;">å¤šçº¿ç¨‹</a> <a href="/tags/æ‰‹æœº/" style="font-size: 10px;">æ‰‹æœº</a> <a href="/tags/æ•°æ®ç»“æ„/" style="font-size: 10px;">æ•°æ®ç»“æ„</a> <a href="/tags/è®¾è®¡æ€è·¯/" style="font-size: 12.5px;">è®¾è®¡æ€è·¯</a> <a href="/tags/è¯­æ³•/" style="font-size: 11.25px;">è¯­æ³•</a> <a href="/tags/é”/" style="font-size: 10px;">é”</a> <a href="/tags/é—®é¢˜/" style="font-size: 12.5px;">é—®é¢˜</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">å‹æƒ…è¿æ¥</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://blog.lutty.me/" target="_blank">lutty</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019&nbsp;
            <i class="fa fa-heartbeat heartbeat" style="color: #F22E3C;"></i>&nbsp;
            <a class="me" href="https://hocg.in" target="_blank">hocgin</a>.
            <p>
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.
                Theme by <a href="http://github.com/ppoffice" target="_blank">PPOffice</a>.
                Made by <a href="https://hocg.in">hocgin</a>
            </p>
        </div>
    </div>
</footer>
        
    
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.6/dist/Valine.min.js"></script>
    <script>
        new Valine({
            el: '#valine-thread' ,
            notify:false,
            verify:false,
            app_id: 'UgznLOt1wcUYIgK8LbBRwXOR-gzGzoHsz',
            app_key: 'hyCCbbO9B8bTXEBe1KEuJ95K',
            placeholder: 'ç•™è¨€ä¸€ä¸‹å‘—'
        });
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>
<script src="/js/hocgin.js"></script>

    </div>
    <script>
        var xlm_wid='13073';
        var xlm_url='https://www.xianliao.me/';
    </script>
    <script type='text/javascript' charset='UTF-8' src='http://www.xianliao.me/embed.js'></script>
</body>
</html>