<!--
   _                     _
  | |__   ___   ___ __ _(_)_ __
  | '_ \ / _ \ / __/ _` | | '_ \
  | | | | (_) | (_| (_| | | | | |
  |_| |_|\___/ \___\__, |_|_| |_|
                   |___/
-->
<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>Elasticsearch 随手记 | hocgin (๑`灬´๑)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Elasticsearch 随手记 😋">
<meta name="keywords" content="Elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch 随手记">
<meta property="og:url" content="https://hocg.in/2019/03/23/Elasticsearch 随手记/index.html">
<meta property="og:site_name" content="hocgin (๑`灬´๑)">
<meta property="og:description" content="Elasticsearch 随手记 😋">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-03-23T07:33:38.002Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Elasticsearch 随手记">
<meta name="twitter:description" content="Elasticsearch 随手记 😋">
    

    
        <link rel="alternate" href="/" title="hocgin (๑`灬´๑)" type="application/atom+xml" />
    

    
        <link rel="icon" href="/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/firacode/fira_code.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75635029-1', 'auto');
ga('send', 'pageview');

</script>
    
    
        <meta name="google-site-verification" content="BIu5FVv0ybO_ceKwrQ-A7znPy4ObYjrCIbLTvcKxqAM" />
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <!--<i class="logo"></i>-->
                <span class="site-title">hocgin (๑`灬´๑)</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            <section id="main"><article id="post-Elasticsearch 随手记"
         class="article article-type-post "
         itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        <header class="article-header">
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2019/03/23/Elasticsearch 随手记/">
            <time datetime="2019-03-23T05:53:00.000Z" itemprop="datePublished">2019-03-23</time>
        </a>
    </div>


                <div>•</div>
                
    <div class="article-category">
        <a class="article-category-link" href="/categories/服务端/">服务端</a>
    </div>

            </div>
            
    
        <h1 class="article-title" itemprop="name">
            Elasticsearch 随手记
        </h1>
    

        </header>
        
        
        <div class="article-entry" itemprop="articleBody">
            
            
            <p>Elasticsearch 随手记 😋<br><a id="more"></a></p>
<h2 id="ElasticSearch-对比-MySQL"><a href="#ElasticSearch-对比-MySQL" class="headerlink" title="ElasticSearch 对比 MySQL"></a>ElasticSearch 对比 MySQL</h2><ul>
<li>Index -&gt; Database</li>
<li>Type -&gt; Table</li>
<li>Document -&gt; Row</li>
</ul>
<hr>
<h2 id="索引模版数据类型"><a href="#索引模版数据类型" class="headerlink" title="索引模版数据类型"></a>索引模版数据类型</h2><ul>
<li>字符串类型 <del>string</del>,text,keyword </li>
<li>整数类型 integer,long,short,byte </li>
<li>浮点类型 double,float,half_float,scaled_float </li>
<li>逻辑类型 boolean </li>
<li>日期类型 date </li>
<li>范围类型 range </li>
<li>二进制类型 binary </li>
<li>复合类型 数组类型 array </li>
<li>对象类型 object </li>
<li>嵌套类型 nested </li>
<li>地理类型 地理坐标类型 geo_point </li>
<li>地理地图 geo_shape </li>
<li>特殊类型 IP类型 ip </li>
<li>范围类型 completion </li>
<li>令牌计数类型 token_count </li>
<li>附件类型 attachment </li>
<li>抽取类型 percolator </li>
</ul>
<hr>
<h2 id="API-接口"><a href="#API-接口" class="headerlink" title="API 接口"></a>API 接口</h2><blockquote>
<p>pretty 格式化<br>explain=true 分析</p>
<ul>
<li>通配符</li>
</ul>
</blockquote>
<h3 id="监控操作"><a href="#监控操作" class="headerlink" title="监控操作"></a>监控操作</h3><ul>
<li>监控<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有监控指令</span><br><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/_cat</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h3><ul>
<li><p>查看节点状态</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看设置</span><br><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/_cluster/settings?pretty</span><br></pre></td></tr></table></figure>
</li>
<li><p>实时更改配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 永久生效</span><br><span class="line">curl --user elastic:changeme -XPUT http://127.0.0.1:9200/_cluster/settings -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "persistent": &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br><span class="line"># 暂时生效</span><br><span class="line">curl --user elastic:changeme -XPUT http://127.0.0.1:9200/_cluster/settings -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "transient": &#123;&#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h3><ul>
<li><p>创建索引模版</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XPUT http://127.0.0.1:9200/db_test2 -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "settings":&#123;</span><br><span class="line">        # 节点数量</span><br><span class="line">        "number_of_replicas": 0,</span><br><span class="line">        # 分片数量</span><br><span class="line">        # "number_of_shards": 5,</span><br><span class="line">        # 索引存储类型</span><br><span class="line">        # "index.store.type": "niofs",</span><br><span class="line">        # 默认检索字段</span><br><span class="line">        # "index.query.default_field": "title"</span><br><span class="line">        # "index.unassigned.node_left.delayed_timeout": "5m"</span><br><span class="line">    &#125;,</span><br><span class="line">    "mappings": &#123;</span><br><span class="line">        "example": &#123;</span><br><span class="line">            # 动态变更</span><br><span class="line">            "dynamic": false,</span><br><span class="line">            # 5.x 以上废除</span><br><span class="line">            "_all": &#123;</span><br><span class="line">                "enabled": false</span><br><span class="line">            &#125;,</span><br><span class="line">            "properties": &#123;</span><br><span class="line">                "example_id": &#123;</span><br><span class="line">                    "type": "long"</span><br><span class="line">                &#125;,</span><br><span class="line">                "name": &#123;</span><br><span class="line">                    "type": "text",</span><br><span class="line">                    # 指定分词器</span><br><span class="line">                    "analyzer": "ik_max_word",</span><br><span class="line">                    "search_analyzer": "ik_max_word"</span><br><span class="line">                &#125;,</span><br><span class="line">                "text": &#123;</span><br><span class="line">                    "type": "keyword"</span><br><span class="line">                &#125;,</span><br><span class="line">                "title": &#123;</span><br><span class="line">                    "type": "text",</span><br><span class="line">                    "index": true</span><br><span class="line">                &#125;,</span><br><span class="line">                "createdAt": &#123;</span><br><span class="line">                    "type": "date",</span><br><span class="line">                    "format": "strict_date_optional_time||epoch_millis"</span><br><span class="line">                &#125;,</span><br><span class="line">                "age": &#123;</span><br><span class="line">                    "type": "integer"</span><br><span class="line">                &#125;,</span><br><span class="line">                "location": &#123;</span><br><span class="line">                    # es 中存储结构为: &#123;lon: 0.000, lat: 0.000&#125;</span><br><span class="line">                    "type": "geo_point"</span><br><span class="line">                &#125;,</span><br><span class="line">                "suggest": &#123;</span><br><span class="line">                    "type": "completion"</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除索引模版</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XDELETE http://127.0.0.1:9200/db_test</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询索引模版</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/db_test\?pretty</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/db_test/example -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "example_id": 666</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/db_test/example/_search?pretty</span><br><span class="line"># 按条件查询</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/db_test/example/_search?pretty&amp;explain=true -H "Content-type: application/json" -d '&#123;</span><br><span class="line">    "query": &#123;</span><br><span class="line">        "match": &#123;</span><br><span class="line">            "example_id": 666</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;'</span><br><span class="line"></span><br><span class="line"># 查询指定</span><br><span class="line">curl --user elastic:changeme -XGET http://127.0.0.1:9200/db_test/example/PiAmoGkBJAdUJ3wD4CMC?pretty=true</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="分析操作"><a href="#分析操作" class="headerlink" title="分析操作"></a>分析操作</h3><ul>
<li>分词器接口<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 使用默认分词器</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/_analyze?pretty -H 'Content-Type:application/json' -d'&#123; </span><br><span class="line">    "text": "Hello World" </span><br><span class="line">&#125;'</span><br><span class="line"># 使用指定分词器</span><br><span class="line">curl --user elastic:changeme -XPOST http://127.0.0.1:9200/_analyze?pretty -H 'Content-Type:application/json' -d'&#123;</span><br><span class="line">    "analyzer": "ik_max_word",</span><br><span class="line">    "text": "Hello World" </span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="Java-调用"><a href="#Java-调用" class="headerlink" title="Java 调用"></a>Java 调用</h2><ul>
<li><p>创建索引</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">createOrUpdateIndex</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (house == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ExampleIndexTemplate template = <span class="comment">// .. 通过构建得出</span></span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                .setQuery(QueryBuilders.termQuery(<span class="string">"example_id"</span>, id));</span><br><span class="line"></span><br><span class="line">        logger.debug(requestBuilder.toString());</span><br><span class="line">        SearchResponse searchResponse = requestBuilder.get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> success;</span><br><span class="line">        <span class="keyword">long</span> totalHit = searchResponse.getHits().getTotalHits();</span><br><span class="line">        <span class="keyword">if</span> (totalHit == <span class="number">0</span>) &#123;</span><br><span class="line">            success = create(template);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (totalHit == <span class="number">1</span>) &#123;</span><br><span class="line">            String esId = searchResponse.getHits().getAt(<span class="number">0</span>).getId();</span><br><span class="line">            success = update(id, template);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            success = deleteAndCreate(totalHit, template);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// --</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">create</span><span class="params">(ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            IndexResponse response = <span class="keyword">this</span>.esClient.prepareIndex(INDEX_NAME, INDEX_TYPE)</span><br><span class="line">                    .setSource(objectMapper.writeValueAsBytes(indexTemplate), XContentType.JSON).get();</span><br><span class="line">            <span class="keyword">if</span> (response.status() == RestStatus.CREATED) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Long id, ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UpdateResponse response = <span class="keyword">this</span>.esClient.prepareUpdate(INDEX_NAME, INDEX_TYPE, id).setDoc(objectMapper.writeValueAsBytes(indexTemplate), XContentType.JSON).get();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (response.status() == RestStatus.OK) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">deleteAndCreate</span><span class="params">(<span class="keyword">long</span> totalHit, ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">        DeleteByQueryRequestBuilder builder = DeleteByQueryAction.INSTANCE</span><br><span class="line">                .newRequestBuilder(esClient)</span><br><span class="line">                .filter(QueryBuilders.termQuery(<span class="string">"example_id"</span>, indexTemplate.getId()))</span><br><span class="line">                .source(INDEX_NAME);</span><br><span class="line"></span><br><span class="line">        BulkByScrollResponse response = builder.get();</span><br><span class="line">        <span class="keyword">long</span> deleted = response.getDeleted();</span><br><span class="line">        <span class="keyword">if</span> (deleted != totalHit) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> create(indexTemplate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>移除索引模版</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    DeleteByQueryRequestBuilder builder = DeleteByQueryAction.INSTANCE</span><br><span class="line">            .newRequestBuilder(esClient)</span><br><span class="line">            .filter(QueryBuilders.termQuery(<span class="string">"example_id"</span>, id))</span><br><span class="line">            .source(INDEX_NAME);</span><br><span class="line">    BulkByScrollResponse response = builder.get();</span><br><span class="line">    <span class="keyword">long</span> deleted = response.getDeleted();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>简单搜索</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 通过搜索查询出id， 然后于 mysql 之类数据库进行聚合</span></span><br><span class="line"><span class="function">List&lt;Serializable&gt; <span class="title">search</span><span class="params">(SearchBody body)</span></span>&#123;</span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 满足filter子句的条件。但是不会像Must一样，参与计算分值</span></span><br><span class="line">        boolQuery.filter(</span><br><span class="line">            <span class="comment">// QueryBuilders.termQuery</span></span><br><span class="line">            <span class="comment">// QueryBuilders.rangeQuery</span></span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment">//        提高权重, 如果需要的话</span></span><br><span class="line"><span class="comment">//        boolQuery.must(</span></span><br><span class="line"><span class="comment">//                QueryBuilders.matchQuery("title", body.getKeywords())</span></span><br><span class="line"><span class="comment">//                        .boost(2.0f)</span></span><br><span class="line"><span class="comment">//        );</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// [必须满足的意思] 满足must子句的条件，并且参与计算分值</span></span><br><span class="line">        boolQuery.must(</span><br><span class="line">            <span class="comment">// QueryBuilders.multiMatchQuery  关键词匹配多个字段</span></span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 满足should子句的条件。在一个Bool查询中，如果没有must或者filter，有一个或者多个should子句，那么只要满足一个就可以返回</span></span><br><span class="line">        boolQuery.should(</span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不满足must_not定义的条件</span></span><br><span class="line">        boolQuery.should(</span><br><span class="line">            <span class="comment">//..</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                <span class="comment">// 查询条件</span></span><br><span class="line">                .setQuery(boolQuery)</span><br><span class="line">                <span class="comment">// 排序</span></span><br><span class="line">                .addSort(</span><br><span class="line">                        <span class="string">"createdAt"</span>, <span class="string">"DESC"</span></span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 开始位置</span></span><br><span class="line">                .setFrom(<span class="number">0</span>)</span><br><span class="line">                .setSize(<span class="number">100</span>)</span><br><span class="line">                <span class="comment">// 设置该字段可以有效减少返回数据量</span></span><br><span class="line">                .setFetchSource(<span class="string">"id"</span>, <span class="keyword">null</span>);</span><br><span class="line">        SearchResponse response = requestBuilder.get();</span><br><span class="line"></span><br><span class="line">        List&lt;Long&gt; ids = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSource());</span><br><span class="line">            ids.add(Longs.tryParse(String.valueOf(hit.getSource().get(<span class="string">"example_id"</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自动补全</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配</span></span><br><span class="line"><span class="function">Collection&lt;String&gt; <span class="title">suggest</span><span class="params">(String prefix)</span></span>&#123;</span><br><span class="line">    CompletionSuggestionBuilder suggestion = SuggestBuilders.completionSuggestion(<span class="string">"suggest"</span>).prefix(prefix).size(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        SuggestBuilder suggestBuilder = <span class="keyword">new</span> SuggestBuilder();</span><br><span class="line">        suggestBuilder.addSuggestion(<span class="string">"autocomplete"</span>, suggestion);</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                .suggest(suggestBuilder);</span><br><span class="line"></span><br><span class="line">        SearchResponse response = requestBuilder.get();</span><br><span class="line">        Suggest suggest = response.getSuggest();</span><br><span class="line">        <span class="keyword">if</span> (suggest == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ServiceResult.of(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        Suggest.Suggestion result = suggest.getSuggestion(<span class="string">"autocomplete"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> maxSuggest = <span class="number">0</span>;</span><br><span class="line">        Set&lt;String&gt; suggestSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object term : result.getEntries()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (term <span class="keyword">instanceof</span> CompletionSuggestion.Entry) &#123;</span><br><span class="line">                CompletionSuggestion.Entry item = (CompletionSuggestion.Entry) term;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (item.getOptions().isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (CompletionSuggestion.Entry.Option option : item.getOptions()) &#123;</span><br><span class="line">                    String tip = option.getText().string();</span><br><span class="line">                    <span class="keyword">if</span> (suggestSet.contains(tip)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    suggestSet.add(tip);</span><br><span class="line">                    maxSuggest++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (maxSuggest &gt; <span class="number">5</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> suggestSet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置权重</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">updateSuggest</span><span class="params">(ExampleIndexTemplate indexTemplate)</span> </span>&#123;</span><br><span class="line">    AnalyzeRequestBuilder requestBuilder = <span class="keyword">new</span> AnalyzeRequestBuilder(</span><br><span class="line">            <span class="keyword">this</span>.esClient, AnalyzeAction.INSTANCE, INDEX_NAME, </span><br><span class="line">            <span class="comment">// 会被搜索的字段的值..</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用的分词器</span></span><br><span class="line">    requestBuilder.setAnalyzer(<span class="string">"ik_smart"</span>);</span><br><span class="line"></span><br><span class="line">    AnalyzeResponse response = requestBuilder.get();</span><br><span class="line">    List&lt;AnalyzeResponse.AnalyzeToken&gt; tokens = response.getTokens();</span><br><span class="line">    <span class="keyword">if</span> (tokens == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;HouseSuggest&gt; suggests = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (AnalyzeResponse.AnalyzeToken token : tokens) &#123;</span><br><span class="line">        <span class="comment">// 生效限制</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"&lt;NUM&gt;"</span>.equals(token.getType()) || token.getTerm().length() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExampleSuggest suggest = <span class="comment">// ..</span></span><br><span class="line">        suggests.add(suggest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他影响因素</span></span><br><span class="line">    ExampleSuggest suggest = <span class="comment">// ..</span></span><br><span class="line">    suggests.add(suggest);</span><br><span class="line"></span><br><span class="line">    indexTemplate.setSuggest(suggests);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>聚合统计</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">aggregateNumber</span><span class="params">(String c1, String c2, String c3)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery()</span><br><span class="line">                .filter(QueryBuilders.termQuery(</span><br><span class="line">                    <span class="comment">// 聚合条件</span></span><br><span class="line">                ))</span><br><span class="line">                .filter(QueryBuilders.termQuery(</span><br><span class="line">                    <span class="comment">// 聚合条件</span></span><br><span class="line">                ))</span><br><span class="line">                .filter(QueryBuilders.termQuery(</span><br><span class="line">                    <span class="string">"field_name"</span>,</span><br><span class="line">                    c1</span><br><span class="line">                ));</span><br><span class="line"></span><br><span class="line">        SearchRequestBuilder requestBuilder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">                .setTypes(INDEX_TYPE)</span><br><span class="line">                .setQuery(boolQuery)</span><br><span class="line">                .addAggregation(</span><br><span class="line">                        AggregationBuilders.terms(<span class="string">"agg_number"</span>)</span><br><span class="line">                        .field(<span class="string">"field_name"</span>)</span><br><span class="line">                ).setSize(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        logger.debug(requestBuilder.toString());</span><br><span class="line"></span><br><span class="line">        SearchResponse response = requestBuilder.get();</span><br><span class="line">        <span class="keyword">if</span> (response.status() == RestStatus.OK) &#123;</span><br><span class="line">            Terms terms = response.getAggregations().get(<span class="string">"agg_number"</span>);</span><br><span class="line">            <span class="keyword">if</span> (terms.getBuckets() != <span class="keyword">null</span> &amp;&amp; !terms.getBuckets().isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> terms.getBucketByKey(c1).getDocCount();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>位置范围查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Collection&lt;Long&gt; <span class="title">mapQuery</span><span class="params">(SearchBody body)</span> </span>&#123;</span><br><span class="line">    BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line">    boolQuery.filter(QueryBuilders.termQuery(</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    boolQuery.filter(</span><br><span class="line">        QueryBuilders.geoBoundingBoxQuery(<span class="string">"location"</span>)</span><br><span class="line">            .setCorners(</span><br><span class="line">                    <span class="comment">// 左上角</span></span><br><span class="line">                    <span class="keyword">new</span> GeoPoint(body.getLeftLatitude(), body.getLeftLongitude()),</span><br><span class="line">                    <span class="comment">// 右下角</span></span><br><span class="line">                    <span class="keyword">new</span> GeoPoint(body.getRightLatitude(), body.getRightLongitude())</span><br><span class="line">            ));</span><br><span class="line"></span><br><span class="line">    SearchRequestBuilder builder = <span class="keyword">this</span>.esClient.prepareSearch(INDEX_NAME)</span><br><span class="line">            .setTypes(INDEX_TYPE)</span><br><span class="line">            .setQuery(boolQuery)</span><br><span class="line">            .addSort(</span><br><span class="line">                <span class="comment">// ..</span></span><br><span class="line">            )</span><br><span class="line">            .setFrom(<span class="number">0</span>)</span><br><span class="line">            .setSize(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    SearchResponse response = builder.get();</span><br><span class="line">    <span class="keyword">if</span> (RestStatus.OK != response.status()) &#123;</span><br><span class="line">        <span class="keyword">return</span> ids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">        ids.add(hit.getSource().get(<span class="string">"example_id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="JSON格式查询语法"><a href="#JSON格式查询语法" class="headerlink" title="JSON格式查询语法"></a>JSON格式查询语法</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html" target="_blank" rel="external">官方文档</a></p>
<h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><blockquote>
<ul>
<li>must<code>参与计算分值</code> -&gt; and</li>
<li>filter<code>不参与计算分值</code> -&gt; and</li>
<li>should -&gt; or</li>
<li>must_not -&gt; not<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 布尔查询</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123; </span><br><span class="line">    <span class="attr">"bool"</span>: &#123; </span><br><span class="line">      // The clause (query) must appear in matching documents and will contribute to the score.</span><br><span class="line">      // 所有"must"条件必须匹配成功, 且计算分数</span><br><span class="line">      "must": [</span><br><span class="line">        &#123; "match": &#123; "title":   "Search"        &#125;&#125;, </span><br><span class="line">        &#123; <span class="attr">"match"</span>: &#123; <span class="attr">"content"</span>: <span class="string">"Elasticsearch"</span> &#125;&#125;  </span><br><span class="line">      ],</span><br><span class="line">      // The clause (query) must appear in matching documents. However unlike must the score of the query will be ignored. Filter clauses are executed in filter context, meaning that scoring is ignored and clauses are considered for caching.</span><br><span class="line">      // 所有"filter"条件必须匹配成功, 不计算分数(因此查询速度较快)</span><br><span class="line">      "filter": [ </span><br><span class="line">        &#123; "term":  &#123; "status": "published" &#125;&#125;, </span><br><span class="line">        &#123; <span class="attr">"range"</span>: &#123; <span class="attr">"publish_date"</span>: &#123; <span class="attr">"gte"</span>: <span class="string">"2015-01-01"</span> &#125;&#125;&#125; </span><br><span class="line">      ],</span><br><span class="line">      // The clause (query) should appear in the matching document. If the bool query is in a query context and has a must or filter clause then a document will match the bool query even if none of the should queries match. In this case these clauses are only used to influence the score. If the bool query is a filter context or has neither must or filter then at least one of the should queries must match a document for it to match the bool query. This behavior may be explicitly controlled by settings the minimum_should_match parameter.</span><br><span class="line">      // 情况一(嵌套bool): 当"should"条件在"must"条件或者"filter"条件内, 此时不要求满足"should"条件, 但是会影响到查询分数</span><br><span class="line">      // 情况二(单条bool): 当"should"条件不在"must"条件或者"filter"条件内, 默认情况至少有一个"should"子句需要满足(可通过配置`minimum_should_match`参数进行变更)</span><br><span class="line">      "should": [</span><br><span class="line">        &#123; <span class="attr">"range"</span>: &#123;<span class="attr">"age"</span> : &#123; <span class="attr">"gte"</span> : <span class="number">10</span>, <span class="attr">"lte"</span> : <span class="number">20</span> &#125;&#125;&#125;</span><br><span class="line">      ],</span><br><span class="line">      "minimum_should_match": 1,</span><br><span class="line">      // The clause (query) must not appear in the matching documents. Clauses are executed in filter context meaning that scoring is ignored and clauses are considered for caching. Because scoring is ignored, a score of 0 for all documents is returned.</span><br><span class="line">      // 所有"must_not"条件不能匹配成功</span><br><span class="line">      "must_not": [</span><br><span class="line">        &#123; "term": &#123; "tag" : "wow" &#125;&#125;,</span><br><span class="line">        &#123; <span class="attr">"term"</span>: &#123; <span class="attr">"tag"</span> : <span class="string">"elasticsearch"</span> &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h3><blockquote>
<p>会走分析器</p>
<ul>
<li>match<br>描述: 匹配查询, 只需包含部分。eg: hello world, 只匹配”hello”或者”world”<br>可接受类型: text/numerics/dates<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">// 简单查询</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"message"</span> : <span class="string">"this is a test"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 复杂查询</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"message"</span> : &#123;</span><br><span class="line">                <span class="attr">"query"</span>: <span class="string">"this is a test"</span>,</span><br><span class="line">                <span class="attr">"参数"</span>: <span class="string">"值"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ul>
<li><p>match_phrase</p>
<blockquote>
<p>描述: 匹配词组查询, 多个词一起被查询. eg: hello world, 匹配”hello world”</p>
</blockquote>
</li>
<li><p>match_phrase_prefix</p>
<blockquote>
<p>描述: 同<code>match_phrase</code>但是最后一个词会被当作前缀去匹配. eg: hello wo, 可匹配到”hello world”</p>
</blockquote>
</li>
<li><p>multi_match</p>
<blockquote>
<p>描述: 同<code>match</code>但是可以作用在多个字段上，且字段支持表达式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"multi_match"</span> : &#123;</span><br><span class="line">      <span class="attr">"query"</span>:    <span class="string">"this is a test"</span>, </span><br><span class="line">      <span class="attr">"fields"</span>: [ <span class="string">"subject"</span>, <span class="string">"*_name"</span> ],</span><br><span class="line">      <span class="attr">"参数"</span>: <span class="string">"值"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>common</p>
<blockquote>
<p>描述: 根据词频进行匹配.</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"common"</span>: &#123;</span><br><span class="line">            <span class="attr">"body"</span>: &#123;</span><br><span class="line">                <span class="attr">"query"</span>: <span class="string">"this is bonsai cool"</span>,</span><br><span class="line">                // 词频率: [0, 1]</span><br><span class="line">                "cutoff_frequency": 0.001</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>query_string<blockquote>
<p>描述: 根据表达式进行匹配, 输入的值为表达式, 支持一些内置参数和语法。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"query_string"</span>: &#123;</span><br><span class="line">            <span class="attr">"query"</span>: <span class="string">"(content:this OR name:this) AND (content:that OR name:that)"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>simple_query_string<blockquote>
<p>描述: 与<code>query_string</code>类似, 支持一些更简便的符号。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"simple_query_string"</span> : &#123;</span><br><span class="line">        <span class="attr">"query"</span>: <span class="string">"\"fried eggs\" +(eggplant | potato) -frittata"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [<span class="string">"title^5"</span>, <span class="string">"body"</span>],</span><br><span class="line">        <span class="attr">"default_operator"</span>: <span class="string">"and"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><blockquote>
<p>精准搜索<br>一般用于结构化数据而非全文匹配: numbers, dates, and enums</p>
</blockquote>
<ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="external">term</a></p>
<blockquote>
<p>描述: 匹配单个值, 类似”=”, 但是其具备<code>Elasticsearch</code>的特性如: 分数</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// 简单</span><br><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"Kimchy"</span> &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 复杂，设定匹配分数之类的</span><br><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"should"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"term"</span>: &#123;</span><br><span class="line">            <span class="attr">"status"</span>: &#123;</span><br><span class="line">              <span class="attr">"value"</span>: <span class="string">"urgent"</span>,</span><br><span class="line">              <span class="attr">"boost"</span>: <span class="number">2.0</span> </span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"term"</span>: &#123;</span><br><span class="line">            <span class="attr">"status"</span>: <span class="string">"normal"</span> </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="external">terms</a></p>
<blockquote>
<p>描述: 匹配多个值, 类似”in”</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 简单</span><br><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"terms"</span> : &#123; <span class="attr">"user"</span> : [<span class="string">"kimchy"</span>, <span class="string">"elasticsearch"</span>]&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-set-query.html" target="_blank" rel="external">terms_set</a><blockquote>
<p>描述: 定制化匹配规则</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /my-index/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"terms_set"</span>: &#123;</span><br><span class="line">            <span class="attr">"codes"</span> : &#123;</span><br><span class="line">                <span class="attr">"terms"</span> : [<span class="string">"abc"</span>, <span class="string">"def"</span>, <span class="string">"ghi"</span>],</span><br><span class="line">                <span class="attr">"minimum_should_match_field"</span>: <span class="string">"required_matches"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="external">range</a><blockquote>
<p>描述: 范围匹配, 支持: string，date，numeric</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"range"</span> : &#123;</span><br><span class="line">            <span class="attr">"age"</span> : &#123;</span><br><span class="line">                <span class="attr">"gte"</span> : <span class="number">10</span>,</span><br><span class="line">                <span class="attr">"lte"</span> : <span class="number">20</span>,</span><br><span class="line">                <span class="attr">"boost"</span> : <span class="number">2.0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="external">exists</a><blockquote>
<p>描述: 存在查询, 必须至少存在一个非<code>null</code>值. eg: user: [null, ‘hocgin’]</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"exists"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"user"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html" target="_blank" rel="external">prefix</a><blockquote>
<p>描述: 前缀匹配.</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123; <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki"</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="external">wildcard</a></p>
<blockquote>
<p>描述: 通配符匹配。类似<code>like</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"wildcard"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki*y"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="external">regexp</a></p>
<blockquote>
<p>描述: 正则匹配，允许使用正则表达式。<br>⚠️: 性能取决于正则表达式写法，建议用<code>饥饿模式</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"regexp"</span>:&#123;</span><br><span class="line">            <span class="attr">"name.first"</span>: <span class="string">"s.*y?"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="external">fuzzy</a><blockquote>
<p>描述: 模糊查询. 适用于拼写错误时搜索。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">       <span class="attr">"fuzzy"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"ki"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="external">type</a><blockquote>
<p>描述: 文档类型查询</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span> : &#123;</span><br><span class="line">            <span class="attr">"value"</span> : <span class="string">"_doc"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="external">ids</a><blockquote>
<p>描述: 根据<code>id</code>字段过滤文档数据</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"ids"</span> : &#123;</span><br><span class="line">            <span class="attr">"type"</span> : <span class="string">"_doc"</span>,</span><br><span class="line">            <span class="attr">"values"</span> : [<span class="string">"1"</span>, <span class="string">"4"</span>, <span class="string">"100"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="复合查询"><a href="#复合查询" class="headerlink" title="复合查询"></a>复合查询</h3><ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-constant-score-query.html#query-dsl-constant-score-query" target="_blank" rel="external">constant_score</a></p>
<blockquote>
<p>描述: 忽略评分查询, 查询速度更快(使用缓存)。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"constant_score"</span> : &#123;</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span>&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"boost"</span> : <span class="number">1.2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" target="_blank" rel="external">Bool 查询</a></p>
<blockquote>
<p>描述: 使用其他查询的bool值组合的查询。详细参考<code>概要</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span> : &#123;</span><br><span class="line">      <span class="attr">"must"</span> : &#123;</span><br><span class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"filter"</span>: &#123;</span><br><span class="line">        <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"tech"</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"must_not"</span> : &#123;</span><br><span class="line">        <span class="attr">"range"</span> : &#123;</span><br><span class="line">          <span class="attr">"age"</span> : &#123; <span class="attr">"gte"</span> : <span class="number">10</span>, <span class="attr">"lte"</span> : <span class="number">20</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"should"</span> : [</span><br><span class="line">        &#123; <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"wow"</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">"term"</span> : &#123; <span class="attr">"tag"</span> : <span class="string">"elasticsearch"</span> &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"minimum_should_match"</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"boost"</span> : <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-dis-max-query.html" target="_blank" rel="external">Dis Max Query</a><blockquote>
<p>描述: 取多个条件查询结果中，得分最高的查询结果。可以通过: <code>tie_breaker</code> 来关联其他查询结果的分数。</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"dis_max"</span> : &#123;</span><br><span class="line">            // 此处相当于除最佳匹配外，其他匹配结果的参与程度.   --- 言外之意, 多方面考虑</span><br><span class="line">            "tie_breaker" : 0.7,</span><br><span class="line">            "boost" : 1.2,</span><br><span class="line">            "queries" : [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"term"</span> : &#123; <span class="attr">"age"</span> : <span class="number">34</span> &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"term"</span> : &#123; <span class="attr">"age"</span> : <span class="number">35</span> &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html" target="_blank" rel="external">Function Score Query</a></p>
<blockquote>
<p>描述: 打分器. 最后打分阶段，引入一些最佳值的计算方式.         — 言外之意，作弊器</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"function_score"</span>: &#123;</span><br><span class="line">            <span class="attr">"query"</span>: &#123; <span class="attr">"match_all"</span>: &#123;&#125; &#125;,</span><br><span class="line">            <span class="attr">"boost"</span>: <span class="string">"5"</span>,</span><br><span class="line">            <span class="attr">"random_score"</span>: &#123;&#125;, </span><br><span class="line">            <span class="attr">"boost_mode"</span>:<span class="string">"multiply"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-boosting-query.html" target="_blank" rel="external">Boosting Query</a></p>
<blockquote>
<p>描述: 设置条件的权重.</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"boosting"</span> : &#123;</span><br><span class="line">            <span class="attr">"positive"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123;</span><br><span class="line">                    <span class="attr">"field1"</span> : <span class="string">"value1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"negative"</span> : &#123;</span><br><span class="line">                 <span class="attr">"term"</span> : &#123;</span><br><span class="line">                     <span class="attr">"field2"</span> : <span class="string">"value2"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"negative_boost"</span> : <span class="number">0.2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-nested-query.html#query-dsl-nested-query" target="_blank" rel="external">Nested Query</a><blockquote>
<p>描述</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"nested"</span> : &#123;</span><br><span class="line">            // 嵌套对象路径</span><br><span class="line">            "path" : "obj1",</span><br><span class="line">            // 影响的计分方式</span><br><span class="line">            "score_mode" : "avg",</span><br><span class="line">            "query" : &#123;</span><br><span class="line">                "bool" : &#123;</span><br><span class="line">                    "must" : [</span><br><span class="line">                        // ⚠️: 字段必须是完整路径</span><br><span class="line">                    &#123; "match" : &#123;"obj1.name" : "blue"&#125; &#125;,</span><br><span class="line">                    &#123; <span class="attr">"range"</span> : &#123;<span class="attr">"obj1.count"</span> : &#123;<span class="attr">"gt"</span> : <span class="number">5</span>&#125;&#125; &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-child-query.html" target="_blank" rel="external">Has Child Query</a><blockquote>
<p>描述: 进行子文档查询, 返回父文档. 慢查询，慎用</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"has_child"</span> : &#123;</span><br><span class="line">            <span class="attr">"type"</span> : <span class="string">"blog_tag"</span>,</span><br><span class="line">            <span class="attr">"score_mode"</span> : <span class="string">"min"</span>,</span><br><span class="line">            <span class="attr">"query"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123;</span><br><span class="line">                    <span class="attr">"tag"</span> : <span class="string">"something"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-has-parent-query.html" target="_blank" rel="external">Has Parent Query</a><blockquote>
<p>描述: 父文档查询，返回子文档. </p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"has_parent"</span> : &#123;</span><br><span class="line">            <span class="attr">"parent_type"</span> : <span class="string">"blog"</span>,</span><br><span class="line">            <span class="attr">"query"</span> : &#123;</span><br><span class="line">                <span class="attr">"term"</span> : &#123;</span><br><span class="line">                    <span class="attr">"tag"</span> : <span class="string">"something"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="">Parent Id Query</a><blockquote>
<p>描述: 父ID查询，返回子文档</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"parent_id"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"my_child"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"1"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="地理位置查询"><a href="#地理位置查询" class="headerlink" title="地理位置查询"></a>地理位置查询</h3><blockquote>
<p>需要<code>geo_shape</code>类型</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-shape-query.html" target="_blank" rel="external">GeoShape Query</a><br>描述: GeoShape 查询，查询在多边形(基于GeoJSON)内的点。既: 用一个多边形去搜索。</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /example/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>:&#123;</span><br><span class="line">        <span class="attr">"bool"</span>: &#123;</span><br><span class="line">            <span class="attr">"must"</span>: &#123;</span><br><span class="line">                <span class="attr">"match_all"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span>: &#123;</span><br><span class="line">                <span class="attr">"geo_shape"</span>: &#123;</span><br><span class="line">                    <span class="attr">"location"</span>: &#123;</span><br><span class="line">                        <span class="attr">"shape"</span>: &#123;</span><br><span class="line">                            <span class="attr">"type"</span>: <span class="string">"envelope"</span>,</span><br><span class="line">                            <span class="attr">"coordinates"</span> : [[<span class="number">13.0</span>, <span class="number">53.0</span>], [<span class="number">14.0</span>, <span class="number">52.0</span>]]</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"relation"</span>: <span class="string">"within"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-bounding-box-query.html#query-dsl-geo-bounding-box-query" target="_blank" rel="external">Geo Bounding Box Query</a><blockquote>
<p>描述: 地理边界框查询，即用一个边界范围去搜索。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"must"</span> : &#123;</span><br><span class="line">                <span class="attr">"match_all"</span> : &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"geo_bounding_box"</span> : &#123;</span><br><span class="line">                    <span class="attr">"pin.location"</span> : &#123;</span><br><span class="line">                        <span class="attr">"top_left"</span> : &#123;</span><br><span class="line">                            <span class="attr">"lat"</span> : <span class="number">40.73</span>,</span><br><span class="line">                            <span class="attr">"lon"</span> : <span class="number">-74.1</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">"bottom_right"</span> : &#123;</span><br><span class="line">                            <span class="attr">"lat"</span> : <span class="number">40.01</span>,</span><br><span class="line">                            <span class="attr">"lon"</span> : <span class="number">-71.12</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-distance-query.html" target="_blank" rel="external">Geo Distance Query</a><blockquote>
<p>描述: 地理距离查询</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /my_locations/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"must"</span> : &#123;</span><br><span class="line">                <span class="attr">"match_all"</span> : &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"geo_distance"</span> : &#123;</span><br><span class="line">                    <span class="attr">"distance"</span> : <span class="string">"200km"</span>,</span><br><span class="line">                    <span class="attr">"pin.location"</span> : &#123;</span><br><span class="line">                        <span class="attr">"lat"</span> : <span class="number">40</span>,</span><br><span class="line">                        <span class="attr">"lon"</span> : <span class="number">-70</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-geo-polygon-query.html" target="_blank" rel="external">Geo Polygon Query</a><blockquote>
<p>描述: 地理多边形查询, 返回围栏内的数据</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"must"</span> : &#123;</span><br><span class="line">                <span class="attr">"match_all"</span> : &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"geo_polygon"</span> : &#123;</span><br><span class="line">                    <span class="attr">"person.location"</span> : &#123;</span><br><span class="line">                        <span class="attr">"points"</span> : [</span><br><span class="line">                            &#123;<span class="attr">"lat"</span> : <span class="number">40</span>, <span class="attr">"lon"</span> : <span class="number">-70</span>&#125;,</span><br><span class="line">                            &#123;<span class="attr">"lat"</span> : <span class="number">30</span>, <span class="attr">"lon"</span> : <span class="number">-80</span>&#125;,</span><br><span class="line">                            &#123;<span class="attr">"lat"</span> : <span class="number">20</span>, <span class="attr">"lon"</span> : <span class="number">-90</span>&#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="定制化查询"><a href="#定制化查询" class="headerlink" title="定制化查询"></a>定制化查询</h3><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html" target="_blank" rel="external">More Like This Query</a><blockquote>
<p>描述: 根据字段进行匹配文字的相识度，一般用于进行文章或内容的相识度推荐</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"more_like_this"</span> : &#123;</span><br><span class="line">            <span class="attr">"fields"</span> : [<span class="string">"title"</span>, <span class="string">"description"</span>],</span><br><span class="line">            <span class="attr">"like"</span> : <span class="string">"Once upon a time"</span>,</span><br><span class="line">            <span class="attr">"min_term_freq"</span> : <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"max_query_terms"</span> : <span class="number">12</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-script-query.html" target="_blank" rel="external">Script Query</a><blockquote>
<p>描述: 脚本查询，使用特定的语法脚本进行查询。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"bool"</span> : &#123;</span><br><span class="line">            <span class="attr">"filter"</span> : &#123;</span><br><span class="line">                <span class="attr">"script"</span> : &#123;</span><br><span class="line">                    <span class="attr">"script"</span> : &#123;</span><br><span class="line">                        <span class="attr">"source"</span>: <span class="string">"doc['num1'].value &gt; 1"</span>,</span><br><span class="line">                        <span class="attr">"lang"</span>: <span class="string">"painless"</span></span><br><span class="line">                     &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-percolate-query.html" target="_blank" rel="external">Percolate Query</a><blockquote>
<p>描述: Percolate查询，可用于匹配存储在索引中的查询, </p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /my-index/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"percolate"</span> : &#123;</span><br><span class="line">            <span class="attr">"field"</span> : <span class="string">"query"</span>,</span><br><span class="line">            <span class="attr">"document"</span> : &#123;</span><br><span class="line">                <span class="attr">"message"</span> : <span class="string">"A new bonsai tree in the office"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wrapper-query.html" target="_blank" rel="external">Wrapper Query</a><blockquote>
<p>描述: 包装器查询, 将查询条件字符串 base64 编码</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"wrapper"</span>: &#123;</span><br><span class="line">            // &#123;"term" : &#123; "user" : "Kimchy" &#125;&#125;</span><br><span class="line">            "query" : "eyJ0ZXJtIiA6IHsgInVzZXIiIDogIktpbWNoeSIgfX0=" </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="跨度查询"><a href="#跨度查询" class="headerlink" title="跨度查询"></a>跨度查询</h3><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-term-query.html" target="_blank" rel="external">Span Term Query</a><blockquote>
<p>描述: 等价于<code>term</code></p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-multi-term-query.html" target="_blank" rel="external">Span Multi Term Query</a><blockquote>
<p>描述: 多个跨度查询组合, 允许 (wildcard, fuzzy, prefix, range or regexp query) 之一</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_multi"</span>:&#123;</span><br><span class="line">            <span class="attr">"match"</span>:&#123;</span><br><span class="line">                <span class="attr">"prefix"</span> : &#123; <span class="attr">"user"</span> :  &#123; <span class="attr">"value"</span> : <span class="string">"ki"</span>, <span class="attr">"boost"</span> : <span class="number">1.08</span> &#125; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-first-query.html#query-dsl-span-first-query" target="_blank" rel="external">Span First Query</a><blockquote>
<p>描述: 跨度优先查询，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_first"</span> : &#123;</span><br><span class="line">            <span class="attr">"match"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"user"</span> : <span class="string">"kimchy"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"end"</span> : <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-near-query.html" target="_blank" rel="external">Span Near Query</a><blockquote>
<p>描述: 接受多个跨度查询，其匹配必须在彼此的指定距离内，并且可能以相同的顺序。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">            <span class="attr">"clauses"</span> : [</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value1"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value2"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value3"</span> &#125; &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"slop"</span> : <span class="number">12</span>,</span><br><span class="line">            <span class="attr">"in_order"</span> : <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-or-query.html" target="_blank" rel="external">Span Or Query</a><blockquote>
<p>描述: 组合多个跨度查询 - 返回与任何指定查询匹配的文档。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_or"</span> : &#123;</span><br><span class="line">            <span class="attr">"clauses"</span> : [</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value1"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value2"</span> &#125; &#125;,</span><br><span class="line">                &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field"</span> : <span class="string">"value3"</span> &#125; &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-not-query.html" target="_blank" rel="external">Span Not Query</a><blockquote>
<p>描述: 包装另一个span查询，并排除与该查询匹配的任何文档。</p>
</blockquote>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_not"</span> : &#123;</span><br><span class="line">            <span class="attr">"include"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"hoya"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"exclude"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">                    <span class="attr">"clauses"</span> : [</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"la"</span> &#125; &#125;,</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"hoya"</span> &#125; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"slop"</span> : <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">"in_order"</span> : <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-containing-query.html" target="_blank" rel="external">Span Containing Query</a><blockquote>
<p>描述: 接受跨度查询列表，但仅返回与第二个跨度查询匹配的跨度。</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/_search" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_containing"</span> : &#123;</span><br><span class="line">            <span class="attr">"little"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"foo"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"big"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">                    <span class="attr">"clauses"</span> : [</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"bar"</span> &#125; &#125;,</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"baz"</span> &#125; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"slop"</span> : <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">"in_order"</span> : <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-within-query.html" target="_blank" rel="external">Span Within Query</a><blockquote>
<p>描述: 只要其跨度落在由其他跨度查询列表返回的跨度内，就会返回单跨度查询的结果。</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/_search" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"span_within"</span> : &#123;</span><br><span class="line">            <span class="attr">"little"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"foo"</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"big"</span> : &#123;</span><br><span class="line">                <span class="attr">"span_near"</span> : &#123;</span><br><span class="line">                    <span class="attr">"clauses"</span> : [</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"bar"</span> &#125; &#125;,</span><br><span class="line">                        &#123; <span class="attr">"span_term"</span> : &#123; <span class="attr">"field1"</span> : <span class="string">"baz"</span> &#125; &#125;</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"slop"</span> : <span class="number">5</span>,</span><br><span class="line">                    <span class="attr">"in_order"</span> : <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-field-masking-query.html" target="_blank" rel="external">Span Field Masking Query</a><blockquote>
<p>描述: 允许查询不同的字段span-near或span-or跨不同字段。</p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/_search" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"span_near"</span>: &#123;</span><br><span class="line">      <span class="attr">"clauses"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"span_term"</span>: &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"quick brown"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"field_masking_span"</span>: &#123;</span><br><span class="line">            <span class="attr">"query"</span>: &#123;</span><br><span class="line">              <span class="attr">"span_term"</span>: &#123;</span><br><span class="line">                <span class="attr">"text.stems"</span>: <span class="string">"fox"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"text"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"slop"</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"in_order"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><blockquote>
<p>elasticsearch-plugin install {url}</p>
<ul>
<li><a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="external">中文分词插件</a></li>
</ul>
</blockquote>
<hr>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="external">ElasticSearch 官方文档</a><br><a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="external">全文搜索引擎 Elasticsearch 入门教程</a></p>

            
    <div class="article-tag">
        <a class="tag-link" href="/tags/Elasticsearch/">Elasticsearch</a>
    </div>

            

        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="https://hocg.in/2019/03/23/Elasticsearch 随手记/" data-id="ck2srtwtk00b9etavtjz1ah62" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
    
<nav id="article-nav">
    
        <a href="/2019/04/01/Linux 下网络相关的命令/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Linux 下网络相关的命令
                
            </div>
        </a>
    
    
        <a href="/2019/03/08/k8s与kubeadm使用的一些记录/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">K8s 与 kubeadm 使用的一些记录</div>
        </a>
    
</nav>


    
</article>



    
        <section id="comments">
    <div id="valine-thread"></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        <div class="widget-wrap">
    <h3 class="widget-title">关注我</h3>
    <div class="widget">
        <a class="social" href="https://github.com/hocgin" target="_blank"><i class="fa fa-github fa-2x"></i></a>
        <a class="social" href="https://weibo.com/u/2006617153" target="_blank"><i class="fa fa-weibo fa-2x"></i></a>
        <a class="social" href="https://www.500px.com/hocgin" target="_blank"><i class="fa fa-500px fa-2x"></i></a>
        <a class="social" href="https://hocg.in/atom.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>
        <a class="social" href="https://hocg.in/Resume" target="_blank"><span class="fa-2x">简</span></a>
    </div>
</div>
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">近期文章</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/Web/">Web</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/04/18/关于网约车核心业务-推单相关整理/" class="title">关于网约车核心业务-推单相关设计整理</a></p>
                            <!--<p class="item-date"><time datetime="2019-04-18T10:20:20.000Z" itemprop="datePublished">2019-04-18</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/Linux/">Linux</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/04/01/Linux 下网络相关的命令/" class="title">Linux 下网络相关的命令</a></p>
                            <!--<p class="item-date"><time datetime="2019-04-01T00:07:00.000Z" itemprop="datePublished">2019-04-01</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/服务端/">服务端</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/03/23/Elasticsearch 随手记/" class="title">Elasticsearch 随手记</a></p>
                            <!--<p class="item-date"><time datetime="2019-03-23T05:53:00.000Z" itemprop="datePublished">2019-03-23</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/K8s/">K8s</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/03/08/k8s与kubeadm使用的一些记录/" class="title">K8s 与 kubeadm 使用的一些记录</a></p>
                            <!--<p class="item-date"><time datetime="2019-03-08T01:13:00.000Z" itemprop="datePublished">2019-03-08</time></p>-->
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <!--<p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>-->
                            <p class="item-title fa fa-angle-right"><a href="/2019/02/02/如何做单元测试/" class="title">如何做单元测试</a></p>
                            <!--<p class="item-date"><time datetime="2019-02-02T05:17:21.000Z" itemprop="datePublished">2019-02-02</time></p>-->
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
<div class="widget-wrap" id="widget-toc">
    <h3 class="widget-title">
        文章目录
    </h3>
    <div class="widget">
        <!--toc-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
            <div class="post-toc">
                <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch-对比-MySQL"><span class="nav-number">1.</span> <span class="nav-text">ElasticSearch 对比 MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引模版数据类型"><span class="nav-number">2.</span> <span class="nav-text">索引模版数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API-接口"><span class="nav-number">3.</span> <span class="nav-text">API 接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#监控操作"><span class="nav-number">3.1.</span> <span class="nav-text">监控操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#节点操作"><span class="nav-number">3.2.</span> <span class="nav-text">节点操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据操作"><span class="nav-number">3.3.</span> <span class="nav-text">数据操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分析操作"><span class="nav-number">3.4.</span> <span class="nav-text">分析操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-调用"><span class="nav-number">4.</span> <span class="nav-text">Java 调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON格式查询语法"><span class="nav-number">5.</span> <span class="nav-text">JSON格式查询语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#概要"><span class="nav-number">5.1.</span> <span class="nav-text">概要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全文搜索"><span class="nav-number">5.2.</span> <span class="nav-text">全文搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件查询"><span class="nav-number">5.3.</span> <span class="nav-text">条件查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复合查询"><span class="nav-number">5.4.</span> <span class="nav-text">复合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接查询"><span class="nav-number">5.5.</span> <span class="nav-text">连接查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#地理位置查询"><span class="nav-number">5.6.</span> <span class="nav-text">地理位置查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定制化查询"><span class="nav-number">5.7.</span> <span class="nav-text">定制化查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跨度查询"><span class="nav-number">5.8.</span> <span class="nav-text">跨度查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插件"><span class="nav-number">6.</span> <span class="nav-text">插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文档"><span class="nav-number">7.</span> <span class="nav-text">文档</span></a></li></ol>
            </div>
        </section>
        <!--/toc-->
    </div>
</div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/CSS3/" style="font-size: 10px;">CSS3</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/DevOps/" style="font-size: 10px;">DevOps</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/GitLab/" style="font-size: 10px;">GitLab</a> <a href="/tags/Gnome/" style="font-size: 10px;">Gnome</a> <a href="/tags/Go/" style="font-size: 10px;">Go</a> <a href="/tags/Google/" style="font-size: 10px;">Google</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Hexo/" style="font-size: 11.25px;">Hexo</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/JAVA/" style="font-size: 10px;">JAVA</a> <a href="/tags/JVM/" style="font-size: 11.25px;">JVM</a> <a href="/tags/Java/" style="font-size: 18.75px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 12.5px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Mac/" style="font-size: 12.5px;">Mac</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/Nexus/" style="font-size: 10px;">Nexus</a> <a href="/tags/Ngrok/" style="font-size: 10px;">Ngrok</a> <a href="/tags/NodeJS/" style="font-size: 12.5px;">NodeJS</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/Oh-My-ZSH/" style="font-size: 10px;">Oh My ZSH</a> <a href="/tags/OpenWrt/" style="font-size: 16.25px;">OpenWrt</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/Pjax/" style="font-size: 10px;">Pjax</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/Shell/" style="font-size: 11.25px;">Shell</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/SpringBoot/" style="font-size: 10px;">SpringBoot</a> <a href="/tags/TCP-IP/" style="font-size: 10px;">TCP/IP</a> <a href="/tags/Thymeleaf/" style="font-size: 10px;">Thymeleaf</a> <a href="/tags/Tip/" style="font-size: 10px;">Tip</a> <a href="/tags/Tips/" style="font-size: 20px;">Tips</a> <a href="/tags/Ubuntu/" style="font-size: 17.5px;">Ubuntu</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Wireshark/" style="font-size: 10px;">Wireshark</a> <a href="/tags/前端/" style="font-size: 11.25px;">前端</a> <a href="/tags/图片墙/" style="font-size: 10px;">图片墙</a> <a href="/tags/多线程/" style="font-size: 13.75px;">多线程</a> <a href="/tags/手机/" style="font-size: 10px;">手机</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/设计思路/" style="font-size: 12.5px;">设计思路</a> <a href="/tags/语法/" style="font-size: 11.25px;">语法</a> <a href="/tags/锁/" style="font-size: 10px;">锁</a> <a href="/tags/问题/" style="font-size: 12.5px;">问题</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">友情连接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://blog.lutty.me/" target="_blank">lutty</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019&nbsp;
            <i class="fa fa-heartbeat heartbeat" style="color: #F22E3C;"></i>&nbsp;
            <a class="me" href="https://hocg.in" target="_blank">hocgin</a>.
            <p>
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.
                Theme by <a href="http://github.com/ppoffice" target="_blank">PPOffice</a>.
                Made by <a href="https://hocg.in">hocgin</a>
            </p>
        </div>
    </div>
</footer>
        
    
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.6/dist/Valine.min.js"></script>
    <script>
        new Valine({
            el: '#valine-thread' ,
            notify:false,
            verify:false,
            app_id: 'UgznLOt1wcUYIgK8LbBRwXOR-gzGzoHsz',
            app_key: 'hyCCbbO9B8bTXEBe1KEuJ95K',
            placeholder: '留言一下呗'
        });
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>
<script src="/js/hocgin.js"></script>

    </div>
    <script>
        var xlm_wid='13073';
        var xlm_url='https://www.xianliao.me/';
    </script>
    <script type='text/javascript' charset='UTF-8' src='http://www.xianliao.me/embed.js'></script>
</body>
</html>